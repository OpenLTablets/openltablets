<h2>Rule Service and Repository Demo</h2>

This is a full-functional demo that will show you how OpenL Web Studio, repository and
runtime application work together. It is a complex demo that requires a careful following of 
the installation instructions.

<h3>Logical Architecture</h3>

The architecture scheme is shown on the Figure 1

<p>

<img src="images/rs-repository-scheme.jpg"/>

<p>

This figure shows a recommended architecture for OpenL Web Studio and runtime deployment. It consists of the following components:

<li> OpenL Web Studio deployed on the Web Application Server (such as Tomcat, Weblogic or Websphere). OpenL Web Studio supports multiple concurrent business clients  
<li> Development JCR-based repository (DEV) - working repository where multiple versions of OpenL and other Eclipse projects are stored and managed during development stage
<li> Runtime JCR-based Repository - repository that is used for deployment of the finished solutions, that may consist of multiple interdependent projects. 
OpenL Web Studio explicitly supports two repositories (DEV and Runtime) - we consider this to be the optimal configuration for enterprise deployment.
<li> Rule Engine Service - Rule Engine deployed in runtime environment and exposed as Web Service application. There can be multiple Rule Engine Service instances 
providing a scalable solution
<li> Demo Web Application - application that uses Rule Engine Service via SOAP over HTTP - this is a typical distribution schema for a rule engine application

<h3>Actual Architecture</h3>

For the purposes of the demo OpenL Web Studio, Demo Web Application, and both repositories are deployed at the same instance of Tomcat application server. 
Rule EngineService starts as a separate java process.

<h3>Deploying and running demo step-by-step</h3>

<h4>Step 1. Create Eclipse project</h4>

Select Eclipse menu <b>File | New | Project</b>. Then select <b>OpenL Tablets | Tools | Application Demo based on Tutorial 4</b>. 

<p>
<img src="images/rs-repository-new-project.jpg"/>

<p>

Press <b>Next</b> and  create a project named <code>org.openl.tablets.demo</code>. It will appear in Eclipse Project Explorer


<h4>Step 2. Unpack demo files using Ant script</h4>

This demo project comes pre-packaged with all the files that are required for the web part of the demo. The installation of the demo
is handled by the Ant script <code>build.xml</code> located in the project's root folder. 

<p>
Before doing the next step make sure that a variable <code>plugin.base.path</code> points into the right location.
It is pre-configured for the configuration(default for OpenL Tablets) where both folders <code>plugins/</code> 
and <code>workspace/</code> are located in the same <code>eclipse/</code> folder.

<p>
Right-click on <code>build.xml</code> and select  <b>Run As | 2 Ant Build</b>. 
In Run Window select <b>deploy</b> task and press <b>Run</b>



<p> 
<img src="images/rs-repository-run-ant.jpg"/>

<p>
Demo will be deployed into <code>/openl</code> folder

<h4>Step 3. Start Tomcat server and Rule Engine Service</h4>


First start Tomcat and then Rule Service using different tasks from <code>build.xml</code>.
The order is important, because Rule Service is dependent on JCR repository deployed on Tomcat.

<p>
Tomcat start requires that System Variable JAVA_HOME have been set to jdk1.5-compatible environment. 
If you have problems starting Tomcat open <code>/openl/Tomcat5.5/bin</code> folder and run startup.bat 
manually. 



<h4>Step 4. Start simple Demo Web Application and check that is works</h4>


Point browser to <a href="http://localhost:8080/demo">http://localhost:8080/demo</a> and run the application. 
  
For example, if you enter age of the driver = <b>71</b> and gender = <b>Male</b> and press Execute button, 
the application will display <b>Senior Driver</b>

<p>
<img src="images/rs-repository-run-demo1.jpg"/>

<p>


<h4>Step 5. Updating rules - Opening Web Studio</h4>


The following procedures will consist of multiple steps, here is a brief summary what is going to happen:

<li>We will check-out rule project in design-time repository
<li>We will edit rule table using Web Studio Table Editor and save 
<li>We will check-in the rules project
<li>We will deploy the checked-in project into runtime repository
<li>Rule Service will automatically receive notification event and reload the newly deployed project
<li>When we execute Demo Web Application again we will see the updated result (magic!!!)

    
<p>
Now we can open Web Studio by clicking <a href="http://123.123.123.123:8080/webstudio">http://123.123.123.123:8080/webstudio</a>.
You need to replace 123.123.123.123 with your server IP address, but you can not use <code>localhost</code> due to the known issue. 
To get IP address on Windows run 
<code>ipconfig</code> in the command console window (DOS window).
The screen will show Web Studio with error message, because Local Workspace is empty.


<h4>Step 6. Updating Rules - Check-out the project</h4>


Switch to Repository View by clicking on the Rules Repository icon <img src="rb-overview_files/storage.gif"/>. 
 
<p>

<img src="images/rs-repository-check-out.jpg"/>
<p>

Select the project <code>org.openl.tablets.tutorial4</code> and click <b>Check Out</b> button.

<p>
<img src="images/rs-repository-check-out-after.jpg"/>
<p>    

Switch to local workspace to edit project by clicking <b>Open LWS in Web Studio</b> icon 
<img src="rb-overview_files/openWebStudio.gif"/>


<h4>Step 7. Edit rules in Web Studio</h4>

Select Decision Table <code>Driver-Eligibility/Driver Age Type</code> and place cursor over the cell 
containing <b>71+</b>. After pop-up menu appears, click <b>Edit</b>.

<p>
<img src="images/rs-repository-select-table.jpg"/>

<p>
In Table Editor change value to <b>75+</b> and click <b>Save</b> icon.

<p>
<img src="images/rs-repository-save-table.jpg"/>



<h4>Step 8. Check-in the project into repository</h4>


Press on <b>Check-in</b> icon <img src="rb-overview_files/checkin.gif"/>.
Switch to the Repository View. Now you can see that the project has  version 0.0.2 
in the design-time repository.

<p>
<img src="images/rs-repository-checked-in.jpg"/>


<h4>Step 9. Deploy the project into runtime repository</h4>

In the Repository View press <b>Smart Redeploy</b> button. 
Smart Redeploy dialog will appear. Select <code>tutorial4</code> project and 
press <b>Deploy</b> button.
<p> 
The project is now deployed in runtime repository. Rule Service automatically 
reloads the deployed project. Now if we go back to our Demo Web Application and run query again
we will see the different result:

<p>

<img src="images/rs-repository-run-demo2.jpg"/>

<p>

<h4>Step 10. The last word</h4>

Congratulations!!! You have mastered the most complex OpenL Tablets demo to date,
now it is time to relax and take another look at the picture at the beginning of 
this document to get another look at OpenL  Tablets recommended architecture. 
Please don't forget to send us your feedback.     
  
 



 




      