<ui:composition
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:a4j="http://richfaces.org/a4j"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:fn="http://java.sun.com/jsp/jstl/functions"
  xmlns:rules="http://openl-tablets.sourceforge.net/jsf"
  template="/facelets/common/studioBase.xhtml">

  <ui:define name="header">
      <a4j:loadScript src="resource:///js/validation.js" />
      <a4j:loadScript src="resource:///js/BaseEditor.js" />
      <a4j:loadScript src="resource:///js/BaseTextEditor.js" />
      <a4j:loadScript src="resource:///js/MultiselectEditor.js" />
      <a4j:loadScript src="resource:///js/DropdownEditor.js" />
      <a4j:loadScript src="resource:///js/AjaxHelper.js" />
      <a4j:loadStyle src="resource:///css/multiselect.css" />
  </ui:define>

  <ui:define name="page">
  
    <br />
  
  	<div class="menuPanel">
        <h:outputLink value="#{contextPath}/faces/facelets/search/simpleSearch.xhtml"
            target="_self">Simple Search</h:outputLink>
        <h:outputLink value="#{contextPath}/faces/facelets/search/indexSearch.xhtml"
            target="_self">Index Search</h:outputLink>
        <h:outputLink value="#{contextPath}/faces/facelets/search/advSearch.xhtml"
            target="_self">Advanced Search</h:outputLink>
    </div>

    <br />

    <table class="search-table">
	<tr><td>
	<h:form id="businessSearchForm">
	<fieldset>
        <legend>Properties</legend>
        <h:dataTable value="#{bussinessSearch.propForSearch}" var="prop">
            <h:column>
                <h:outputText value="#{prop.displayName}"/>
            </h:column>
            <h:column>
	            <rich:calendar value="#{prop.value}" datePattern="#{prop.format}" defaultTime="00:00"
                   timeZone="#{formatPatterns.defaultTimeZone}" rendered="#{prop.date}" />

                <h:outputText binding="#{bussinessSearch.enumHelper.enumOutput}" escape="false" 
                    value="#{bussinessSearch.enumHelper.enumValue}" rendered="#{prop.enum}">
                    <f:attribute name="property" value="#{prop}"/>
                </h:outputText>
                <h:inputHidden value="#{prop.stringValue}" rendered="#{prop.enum}" />

                <h:outputText binding="#{bussinessSearch.enumHelper.enumArrayOutput}" escape="false" 
                    value="#{bussinessSearch.enumHelper.enumArrayValue}" rendered="#{prop.enumArray}">
                    <f:attribute name="property" value="#{prop}"/>
                </h:outputText>
                <h:inputHidden value="#{prop.stringValue}" rendered="#{prop.enumArray}" />

                <h:inputText value="#{prop.stringValue}" rendered="#{prop.stringArray}" />

  		    	<h:inputText value="#{prop.value}"
                    rendered="#{!(prop.date || prop.name == 'version' || prop.boolean || prop.enum || prop.enumArray || prop.stringArray)}" />

                <input type="hidden" name="id" value="#{prop.name}" />
            </h:column>
		</h:dataTable>
	</fieldset>
	<br/>
	<fieldset>
		<h:panelGrid columns="2" cellspacing="5" >
			<h:outputLabel for="content" value="Table Contains" />
			<h:inputText id="content" value="#{bussinessSearch.tableContain}" />
		</h:panelGrid>
	</fieldset>
	<br />
	<h:commandButton value="Search" action="#{bussinessSearchRequest.search}"/>
	</h:form></td></tr>
	</table>

	<c:if test="#{not bussinessSearch.ready}">
  		<p class="warning">There is no valid projects in workspace. Or your session have expired and you need to reload project</p>
	</c:if>
	<c:if test="#{bussinessSearchRequest.searching}">
    	<c:forEach items="#{bussinessSearchRequest.searchResults}" var="table">
        <br />
        <h:panelGroup>
            <img src="#{contextPath}/webresource/images/viewTable.gif" />
            <h:outputLink value="#{contextPath}/faces/facelets/tableeditor/showTable.xhtml">
                <f:param name="uri" value="#{table.uri}" />
                <h:outputText value="View Table" />
            </h:outputLink>
        </h:panelGroup>
        <br />
        <h:panelGroup rendered="#{bussinessSearch.projectEditable}">
            <h:graphicImage url="#{contextPath}/webresource/images/excel.png" />
            <h:outputLink value="#{contextPath}/jsp/showLinks.jsp" target="show_app_hidden">
                <f:param name="uri" value="#{table.uri}" />
                <h:outputText value="View Table in Excel" />
            </h:outputLink>
        </h:panelGroup>
        <br /><br />
        <rules:tableEditor table="#{table}" editable="false" rendered="#{table != null}"
            collapseProps="true" excludeScripts="prototype" />
        <h:outputText value="No rows selected&lt;br/&gt;" rendered="#{table == null}" escape="false" />
     </c:forEach>

	   </c:if>
	
</ui:define>
</ui:composition>