<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:a4j="http://richfaces.org/a4j"
                xmlns:rich="http://richfaces.org/rich"
                xmlns:c="http://java.sun.com/jstl/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:authz="http://rules.openl.org/taglibs/acegi"
                template="/facelets/common/base.xhtml">

  <ui:define name="page">
    <script>
      function ajaxRequestContainsErrors() {
        return document.getElementById("severityForm:maximumSeverity").value >= 2;
      }

      var actionCallback = function() { }

      function onComplete() {
        if (!ajaxRequestContainsErrors()) {
          actionCallback();
        }
      }

      function submitMainForm(callback) {
        actionCallback = callback;
        document.getElementById('mainForm:submitButton').click();
      }
    </script>

    <c:set var="node" value="#{repositoryTreeState.selectedNode}"/>
    <c:set var="artefact" value="#{node.data}"/>

    <a4j:outputPanel id="severityFormPanel" ajaxRendered="true">
      <h:form id="severityForm" style="display:none">
        <h:inputHidden id="maximumSeverity" value="#{facesContext.maximumSeverity.ordinal}" />
      </h:form>
    </a4j:outputPanel>


    <h:form id="mainForm">
      <span id="userName" title="Current user">
        <authz:authentication operation="username"/>
      </span>

      <div id="iconbar">
        <a class="actionButton" href="#" onclick="window.open('http://openl-tablets.sourceforge.net/docs/guide/html/#{versionProperties['openl.version']}/OpenLWebStudio_UserGuide/index.html','help','width=1000,height=800,screenX=50,screenY=100,resizable=yes,scrollbars=yes,status=yes');return false;" title="Help">
          <h:graphicImage url="/webresource/images/help.png" styleClass="actionImage" alt="Help" />
        </a>

        <h:commandLink class="actionButton" action="#{studioOpener.openStudio}" title="Open Rules Editor">
            <h:graphicImage url="/webresource/images/openWebStudio.gif" styleClass="actionImage" alt="Open Rules Editor" />
        </h:commandLink>

        <c:if test="#{not systemConfig['security.logout.hidden']}">
        <a href="#{contextPath}/security_logout" class="actionButton"
          title="Log out" onclick="return confirm('Are you sure you want to Log out?')">
          <h:graphicImage url="/webresource/images/logout.gif" styleClass="actionImage" alt="Log out" />
        </a>
        </c:if>
      </div>

      <div id="colorScheme">
        <h:panelGrid columns="1" cellpadding="0px" cellspacing="0px">
        <h:outputText value="Color scheme"/>
        <h:selectOneMenu value="#{skinBean.skin}" onchange="submit()" required="false">
          <f:selectItems value="#{skinBean.skins}"/>
        </h:selectOneMenu>
        </h:panelGrid>
      </div>

      <a4j:commandButton id="submitButton" reRender="severityFormPanel, nodeView" oncomplete="onComplete()"
        ajaxSingle="false" style="display:none;"/>
      <ui:insert name="body" />
    </h:form>
  </ui:define>
</ui:composition>
