<?xml version="1.0" encoding="utf-8"?>
<ui:composition
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:c="http://java.sun.com/jstl/core"
    xmlns:authz="http://rules.openl.org/taglibs/acegi"
    xmlns:jsffn="http://rules.openl.org/taglibs/jsffn"
    xmlns:a4j="http://richfaces.org/a4j">

    <c:set var="contextPath" value="#{facesContext.externalContext.request.contextPath}"/>

    <a4j:loadStyle src="resource:///css/openl/style1.css" />
    <a4j:loadStyle src="resource:///css/header.css" />

    <style>
        form { margin: 0px; }

        .projectItem {
            margin-top: 3px;
            color: #337AB6;
        }
        .moduleItem {
            padding-left: 10px;
        }
        .toolbar {
            border: 1px dotted rgb(150,150,150);
            border-bottom: 0px;
            padding: 4px 8px 1px 8px;
        }
        .toolbar img {
            -moz-transition: -moz-transform 0.3s;
        }
        .toolbar img:hover {
            -moz-transform: rotate(360deg);
            -moz-transition: -moz-transform 0.3s;
        }
    </style>

    <f:verbatim>
        <script type="text/javascript">
            function selectModule(moduleList) {
                moduleList.disabled = true;
                top.main.location.href = '#{contextPath}/faces/main.xhtml?selectedModule='
                    + encodeURIComponent(moduleList.value);
            }
        </script>
    </f:verbatim>

    <iframe src="#{contextPath}/faces/facelets/sourceModified.xhtml"
        style="visibility: hidden" width="0" height="0" />

    <div id="headerWrapper">
    <table id="header" cellspacing="0" cellpadding="0">
        <tr>
            <td>
                <h:graphicImage url="/webresource/images/print-logo.gif" />
            </td>
            <td style="text-align: right; padding-bottom: 5px;">
                <h:graphicImage url="/webresource/images/logo.png" />
            </td>
        </tr>
        <tr>
            <td>
                <h:form id="headerForm">
                    <h:panelGroup rendered="#{not empty headerBean.modules}">
                        <span style="font-size:12px; font-weight:bold; color:black;">Select Module: </span>
                        <h:selectOneMenu value="#{headerBean.selectedModule}" onchange="selectModule(this)"
                            id="selectedModule" enabledClass="moduleItem" disabledClass="projectItem">
                            <f:selectItems value="#{headerBean.modules}" />
                        </h:selectOneMenu>
                    </h:panelGroup>

                    <h:panelGroup rendered="#{empty headerBean.modules}">
                        <h:outputText value="No OpenL Projects in the Workspace" style="color:red; font-weight: bold" />
                        <br />
                        <c:if test="#{not headerBean.repositoryFailed}">
                            Please go to the 
                            <a target="_top" href="#{contextPath}/faces/facelets/repository/main.xhtml"
                                title="Rules Repository"><h:outputText value="Repository" /></a>
                            to create (upload) a new project
                        </c:if>
                    </h:panelGroup>

                </h:form>
            </td>
            <td style="text-align: right;">
                <h:form>
                <span id="userName" title="Current user">
                    <authz:authentication operation="username"/>
                </span>
                <table style="display: inline;" cellspacing="0" cellpadding="2">
                  <tr><td class="toolbar">
                  <a href="#{contextPath}/faces/main.xhtml?mode=business" title="Business View" target="main"><img
                      alt="Business View"
                      src="#{contextPath}/webresource/images/business-view.png" /></a>
                  <f:verbatim>&amp;nbsp;</f:verbatim>
                  <a href="#{contextPath}/faces/main.xhtml?mode=developer" title="Developer View" target="main"><img
                      alt="Developer View"
                      src="#{contextPath}/webresource/images/developer-view.png" /></a>
                  <f:verbatim>&amp;nbsp;</f:verbatim>
                  <c:if test="#{studio.showFormulas}">
                    <a href="#{contextPath}/faces/main.xhtml?showFormulas=false" title="Dont't Show Formulas"
                        target="main"><img alt="Dont't Show Formulas"
                        src="#{contextPath}/webresource/images/formula.png" /></a>
                  </c:if>
                  <c:if test="#{not studio.showFormulas}">
                    <a href="#{contextPath}/faces/main.xhtml?showFormulas=true" title="Show Formulas" target="main"><img
                        alt="Show Formulas"
                        src="#{contextPath}/webresource/images/formula.png" /></a>
                  </c:if>
                  <f:verbatim>&amp;nbsp;</f:verbatim>

                  <h:panelGroup rendered="#{not empty headerBean.modules and studio.model.editable}">
                  <a href="#{contextPath}/faces/facelets/revertProjectChanges.xhtml" title="Revert Module Changes"
                      target="mainFrame"><img alt="Revert Project Changes"
                      src="#{contextPath}/webresource/images/revert.png" /></a>
                  </h:panelGroup>

                  <f:verbatim>&amp;nbsp;</f:verbatim>

                  <!-- Expand/Collapse Table Properties View  --> 
                  <c:if test="#{studio.collapseProperties}">
                    <a href="#{contextPath}/faces/main.xhtml?collapseProperties=false" title="Expand Properties"
                        target="main"><img alt="Expand Properties"
                        src="#{contextPath}/webresource/images/collapsed_props.gif" /></a>
                  </c:if>
                  <c:if test="#{not studio.collapseProperties}">
                    <a href="#{contextPath}/faces/main.xhtml?collapseProperties=true" title="Collapse Properties"
                        target="main"><img alt="Collapse Properties"
                        src="#{contextPath}/webresource/images/extended_props.gif" /></a>
                  </c:if>

                  <f:verbatim>&amp;nbsp;</f:verbatim>
                  <c:if test="#{jsffn:isLocalRequest()}">
                    <c:if test="#{headerBean.repositoryFailed}">
                      <img src="#{contextPath}/webresource/images/repository/upload-disabled.gif"
                          alt="Upload project(s) failed"/>
                      <f:verbatim>&amp;nbsp;</f:verbatim>
                    </c:if>
                    <c:if test="#{not headerBean.repositoryFailed}">
                      <a target="mainFrame" href="#{contextPath}/faces/facelets/studio/uploadProjects.xhtml"
                          title="Upload project(s) to repository"><img
                          src="#{contextPath}/webresource/images/repository/upload.gif"
                          alt="Upload project(s) to repository"/></a>
                      <f:verbatim>&amp;nbsp;</f:verbatim>
                    </c:if>
                  </c:if>
                  <h:panelGroup rendered="#{not empty headerBean.modules and studio.model.projectCompiledSuccessfully}">
                  <a target="mainFrame"
                      href="#{contextPath}/faces/facelets/search/simpleSearch.xhtml?searchQuery=&quot;openl tablets&quot;"
                      title="Search"><img src="#{contextPath}/webresource/images/search.png" alt="Search"/></a>
                  <f:verbatim>&amp;nbsp;</f:verbatim>
                  </h:panelGroup>
                  <a href="#{contextPath}/faces/main.xhtml?reload=reload&amp;selectedModule=#{headerBean.selectedModule}"
                      title="Refresh Project(s)" target="main"><img src="#{contextPath}/webresource/images/refresh.gif"
                      alt="Refresh Project(s)"/></a>
                  <h:panelGroup rendered="#{studio.model.editable}">
                      <f:verbatim>&amp;nbsp;&amp;nbsp;</f:verbatim>
                      <h:commandLink target="mainFrame" action="#{tableCreatorWizardManager.start}"
                          title="Create new table"><img src="#{contextPath}/webresource/images/newtable.gif"
                          alt="Create new table"/></h:commandLink>
                  </h:panelGroup>
                  <f:verbatim>&amp;nbsp;</f:verbatim>
                  <a target="mainFrame"
                      onclick="window.open('#{contextPath}/faces/facelets/diff/compare.xhtml','Compare','width=1000,height=800,screenX=50,screenY=100,resizable=yes,scrollbars=yes,status=yes');return false;"
                      href="#" title="Compare Excel files"><img
                      src="#{contextPath}/webresource/images/compare.gif" alt="Compare Excel files" /></a>

                  <f:verbatim>&amp;nbsp;</f:verbatim>

                  <h:panelGroup rendered="#{not empty headerBean.modules and studio.model.projectCompiledSuccessfully}">
                  <a href="#{contextPath}/faces/facelets/rulesDependencies.xhtml" title="Rules Dependencies"
                      target="mainFrame"><img alt="Rules Dependencies"
                      src="#{contextPath}/webresource/images/graph.png" /></a>
                  </h:panelGroup>

                  <a href="#{contextPath}/faces/main.xhtml?reload=forced&amp;selectedModule=#{headerBean.selectedModule}"
                      title="Refresh Project with dependencies" target="main"><img
                      src="#{contextPath}/webresource/images/forced_refresh.png" alt="Refresh Project(s)"/></a>
                  <a href="#" onclick="window.open('http://openl-tablets.sourceforge.net/docs/guide/html/#{versionProperties['openl.version']}/OpenLWebStudio_UserGuide/index.html','help','width=1000,height=800,screenX=50,screenY=100,resizable=yes,scrollbars=yes,status=yes');return false;"
                     title="Help"><img src="#{contextPath}/webresource/images/help.png" alt="Help"/></a>

                  <c:if test="#{headerBean.repositoryFailed}">
                    <img src="#{contextPath}/webresource/images/repository/storage-disabled.gif"
                        alt="Rules Repository failed"/>
                  </c:if>
                  <c:if test="#{not headerBean.repositoryFailed}">
                    <a target="_top" href="#{contextPath}/faces/facelets/repository/main.xhtml"
                        title="Rules Repository"><img src="#{contextPath}/webresource/images/repository/storage.gif"
                        alt="Rules Repository"/></a>
                  </c:if>

                  <f:verbatim>&amp;nbsp;</f:verbatim>

                  <a target="mainFrame" href='#{contextPath}/faces/facelets/admin/systemSettings.xhtml'
                        title="System Settings"><img
                        src="#{contextPath}/webresource/images/settings.png" alt="System Settings"/></a>

                  <c:if test="#{not systemConfig['security.logout.hidden']}">
                    <f:verbatim>&amp;nbsp;</f:verbatim>
                    <a target="main" href='#{contextPath}/security_logout' title="Log out"
                        onclick="return confirm('Are you sure you want to Log out?')"><img
                        src="#{contextPath}/webresource/images/logout.gif" alt="Log out"/></a>
                  </c:if>   
                </td>
                </tr>
                </table>
                </h:form>
            </td>
        </tr>  
    </table>
    </div>

</ui:composition>