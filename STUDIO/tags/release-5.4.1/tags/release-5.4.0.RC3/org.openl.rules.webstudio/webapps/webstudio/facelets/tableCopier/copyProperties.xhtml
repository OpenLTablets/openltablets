<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:c="http://java.sun.com/jstl/core"    
    template="/facelets/common/studioWizardBase.xhtml">
    <ui:define name="header">
        <a4j:loadScript src="resource:///js/validation.js" />
        <style>
            .default_Props {
                border: 1px solid rgb(255,255,0);
            }
        </style>
    </ui:define>
    <ui:define name="page">
        <h:messages errorClass="error" infoStyle="color:green" />

        <h:form id="copyTableForm">
            <h2>
	            <h:panelGrid columns="2">
	                <h:outputText value="Technical table name:" />
	                <h:outputText id="technicalName"
	                    value="#{tableCopierWizard.tableTechnicalName}" />
	            </h:panelGrid>
			</h2>
            <br />

	<fieldset><legend>Table Properties</legend>
		<table>
			<a4j:repeat value="#{tableCopierWizard.propsToCopy}" var="prop">
				<tr>
                    <td><h:outputText value="#{prop.displayName}"/></td>
                    <td>
        				<h:inputText value="#{prop.value}" rendered="#{prop.string}" readonly="#{prop.name == 'version'}"/>
                        <rich:calendar value="#{prop.value}" datePattern="#{prop.format}"
                            defaultTime="00:00" timeZone="#{formatPatterns.defaultTimeZone}"
                            rendered="#{prop.date}" />
                        <h:commandButton value="edit" rendered="#{prop.name == 'version'}" onclick="Richfaces.showModalPanel('modalVersionChange'); return false;"/>
        				<h:selectBooleanCheckbox value="#{prop.value}" rendered="#{prop.boolean}" />
                        <input type="hidden" name="id" value="#{prop.name}" />
                    </td>
				</tr>
			</a4j:repeat>
			<!--<tr><td></td><td><b>Default properties:</b></td></tr>
			<a4j:repeat value="#{tableCopierWizard.defaultProps}" var="prop">
				<tr>
                    <td><h:outputText value="#{prop.displayName}"/></td>
                    <td class="default_Props">
    				    <h:inputText value="#{prop.value}" rendered="#{prop.string}" />
                        <rich:calendar value="#{prop.value}" datePattern="#{prop.format}"
                            defaultTime="00:00" timeZone="#{formatPatterns.defaultTimeZone}"
                            rendered="#{prop.date}" />
                        <h:selectBooleanCheckbox value="#{prop.value}" rendered="#{prop.boolean}" />
                    </td>
				</tr>
			</a4j:repeat>-->
		</table>

        <script type="text/javascript">
            var validations = [];
            <a4j:repeat value="#{tableCopierWizard.propsToCopy}" var="prop" binding="#{tableCopierWizard.propsTable}">
                <h:panelGroup rendered="#{not empty prop.constraints.all}">
                    validations.push(<h:outputText value="#{tableCopierWizard.validationJS}" />);
                </h:panelGroup>
            </a4j:repeat>

            function validateAll() {
                var valid = true;
                validations.each(function (v) {
                    valid = valid &amp;&amp; v.validate();
                });
                return valid;
            }
        </script>

		</fieldset>
			<h:inputHidden value="1" id="step" binding="#{tableCopierWizardManager.hiddenStep}" />
      		<h:commandButton value="Prev" action="#{tableCopierWizardManager.prev}" />
      		<h:commandButton value="Next" action="#{tableCopierWizardManager.next}" onclick="return validateAll();" />
      		<h:commandButton value="Cancel" action="#{tableCopierWizardManager.cancel}" />
        </h:form>
        
  <rich:modalPanel id="modalVersionChange" width="400" minWidth="400" height="220" minHeight="220">
    <f:facet name="header">
      <h:outputText value="Version" />
    </f:facet>

    <f:facet name="controls">
      <h:graphicImage value="/images/modal/close.png" style="cursor:pointer" alt="Close" title="Close" onclick="#{rich:component('modalVersionChange')}.hide();" />
    </f:facet>

    <h:form id="changeVersionForm">
      <h:panelGrid columns="2" styleClass="formfields" cellspacing="1" columnClasses="label,">
        <h:outputText value="Current Version" />
        <h:outputText value="#{tableCopierWizard.version.value}"/>
        <h:outputLabel for="major" styleClass="required" value="Major Version" />
        <rich:inputNumberSpinner id="major" minValue="0" value="0" maxValue="32000"
                                 inputSize="4" cycled="false" onchange="adjustNextVersion();"/>
        <h:outputLabel for="minor" styleClass="required" value="Minor Version" />
        <rich:inputNumberSpinner id="minor" minValue="0" value="0" maxValue="32000" cycled="false" inputSize="4" 
                 onchange="adjustNextVersion()"/>
        <h:outputLabel for="variant" styleClass="required" value="Variant Version" />
        <rich:inputNumberSpinner id="variant" minValue="0" value="0" maxValue="32000" inputSize="4" cycled="false"
                 onchange="adjustNextVersion()"/>
        <h:inputHidden id="newVersion" value="#{tableCopierWizard.version.value}" />
      </h:panelGrid>

      <br />
      <rich:separator height="1" />
      <br />

      <h:panelGrid columns="2" styleClass="buttonPanel" cellpadding="4px;" cellspacing="0px;">
        <h:commandButton styleClass="button" value="Ok"/>
        <input type="button" class="button" value="Cancel" onclick="#{rich:component('modalVersionChange')}.hide();" />
      </h:panelGrid>
    </h:form>

    <script>
      function adjustNextVersion() {
        var major = $('changeVersionForm:majorEdit').down().value;
        var minor = $('changeVersionForm:minorEdit').down().value;
        var variant = $('changeVersionForm:variantEdit').down().value;
        $("changeVersionForm:newVersion").value = major + "." + minor + "." + variant;
      }
    </script>
  </rich:modalPanel>

    </ui:define>
</ui:composition>
