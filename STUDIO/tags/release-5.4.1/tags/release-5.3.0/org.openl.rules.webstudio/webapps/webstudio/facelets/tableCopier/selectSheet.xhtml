<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
                template="/facelets/common/wizardBase.xhtml"
        >
    <ui:define name="header">
        <a4j:loadScript src="resource:///javascript/validator.js" />
    </ui:define>
  
  <ui:define name="page">
    <h:messages errorClass="error" infoStyle="color:green" />

    <h2>Select destination</h2>

    <h:form id="destForm">
      <fieldset><legend>Workbook</legend>
      <a4j:region>
        <h:selectOneMenu value="#{tableCopierWizard.workbook}">
          <a4j:support event="onchange" reRender="sheet" ajaxSingle="true" oncomplete="updateControls()"/>
          <f:selectItems value="#{tableCopierWizard.workbooks}"/>
        </h:selectOneMenu> </a4j:region>
        <br/>
      </fieldset>

      <fieldset><legend>Worksheet</legend>
      <h:panelGrid columns="2">
        <h:selectOneRadio id="newSheet" onclick="updateControls()" value="#{tableCopierWizard.newWorksheet}" layout="pageDirection">
          <f:selectItem itemValue="existing" itemLabel="Existing"/>
          <f:selectItem itemValue="new" itemLabel="New"/>
        </h:selectOneRadio>
        <h:panelGrid columns="1">
          <h:selectOneMenu value="#{tableCopierWizard.worksheetIndex}" id="sheet">
            <f:selectItems value="#{tableCopierWizard.worksheets}"/>
          </h:selectOneMenu>
          <h:inputText value="#{tableCopierWizard.newWorksheetName}" id="newSheetName"/>
        </h:panelGrid>
      </h:panelGrid>
      </fieldset>

      <hr/>
      <h:inputHidden value="2" id="step" binding="#{tableCopierWizardManager.hiddenStep}"/>
      <h:commandButton value="Prev" action="#{tableCopierWizardManager.prev}" onclick="enableControls()"/> 
      <h:commandButton value="Copy" action="#{tableCopierWizard.copy}"/>      
      <h:commandButton value="Cancel" action="#{tableCopierWizardManager.cancel}" immediate="true"/>
    </h:form>

    <f:verbatim>
    <script type="text/javascript">
      function validateForm() {
        return validateNewSheetName();
      }
            
      function validateNewSheetName() {
        var e = document.forms['destForm']['destForm:newSheet'][0];
        var newSheet = e.value == 'new' ? e.checked : !e.checked;
        if (newSheet) {
          return validateRequired('destForm:newSheetName', true);
        }
        return true;
      }

      function updateControls() {
        var e = document.forms['destForm']['destForm:newSheet'][0];
        var newSheet = e.value == 'new' ? e.checked : !e.checked;
        $('destForm:sheet').disabled = newSheet;
        $('destForm:newSheetName').disabled = !newSheet;
      }

      function enableControls() {
        $('destForm:sheet').disabled = false;
        $('destForm:newSheetName').disabled = false;
      }

      updateControls();

    </script>
    </f:verbatim>
  </ui:define>
</ui:composition>
