<ui:composition
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:c="http://java.sun.com/jstl/core"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions"
    xmlns:jsffn="http://rules.openl.org/taglibs/jsffn"
    template="/facelets/common/studioBase.xhtml">

    <ui:define name="header">
        <a4j:loadStyle src="resource:///css/indexSearch.css" />
    </ui:define>

    <ui:define name="page">
    
        <br />

        <div class="menuPanel">
            <h:outputLink value="#{contextPath}/faces/facelets/search/simpleSearch.xhtml"
                target="_self">Simple Search</h:outputLink>
            <h:outputLink value="#{contextPath}/faces/facelets/search/busSearch.xhtml"
                target="_self">Business Search</h:outputLink>
            <h:outputLink value="#{contextPath}/faces/facelets/search/advSearch.xhtml"
                target="_self">Advanced Search</h:outputLink>
        </div>

        <br />

        <!-- Index Letters -->
        <div class="lettersPanel">
            <table><tr>
                <a4j:repeat var="letter" value="#{indexSearchBean.indexLetters}">
                    <td>
                        <h:outputLink value="##{letter}">
                            <span><h:outputText value="#{letter}" /></span>
                        </h:outputLink>
                    </td>
                </a4j:repeat>
            </tr></table>
        </div>

        <!-- Search Results -->
        <div class="searchResultsPanel">
            <h:outputText value="No results found" rendered="#{empty indexSearchBean.indexLetters}"
                style="font-weight: bold" />
            <a4j:repeat var="letter" value="#{indexSearchBean.indexLetters}"
                binding="#{indexSearchBean.searchLetters}" rendered="#{not empty indexSearchBean.indexLetters}">
                <c:set var="indexTokens" value="#{indexSearchBean.indexTokens}" />
                <c:set var="tokensLength" value="#{fn:length(indexTokens)}" />
                <div>
                    <a name="#{letter}" style="font-weight: bold; font-size: 160%;">
                        <h:outputText value="#{letter} (#{tokensLength})" />
                    </a>

                    <br /><br />

                    <table>
                        <c:set var="ncols" value="#{jsffn:toNumber(3)}" />
                        <c:set var="nrows" value="#{(tokensLength + ncols - 1) / ncols}" />
                        <c:set var="colWidth" value="#{100 / ncols}" />

                        <c:forEach begin="0" end="#{nrows - 1}" var="row">
                        <tr>
                            <c:forEach begin="0" end="#{ncols - 1}" var="col">
                            <c:set var="indexToken" value="#{indexTokens[col * nrows + row]}" />
                            <td width="#{colWidth}%">
                                <h:outputLink rendered="#{col * nrows + row lt tokensLength}"
                                    value="#{contextPath}/faces/facelets/search/showIndexSearchResults.xhtml">
                                    <f:param name="searchQuery" value="#{indexToken.displayValue}" />
                                    <h:outputText
                                        value="#{indexToken.displayValue} (#{fn:length(indexToken.indexElements)})" />
                                </h:outputLink>
                            </td>
                            </c:forEach>
                        </tr>
                        </c:forEach>
                    </table>
                    <br />
                </div>
            </a4j:repeat>

        </div>

    </ui:define>
</ui:composition>
