<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:rich="http://richfaces.org/rich"
                xmlns:c="http://java.sun.com/jstl/core"
                template="/facelets/common/wizardBase.xhtml">

    <ui:define name="page">
        <c:set var="minVersion" value="#{tableCopierWizard.minVersion}" />
        <h2>Change version</h2>
        <h:form id="changeVersionForm">
            <fieldset>
                <legend>
                    <h:outputText value="Version: " />
                    <h:outputText id="newVersionText" value="#{tableCopierWizard.version.value}" />
                </legend>
                <h:panelGrid columns="2" cellspacing="1" columnClasses="label">
                    <h:outputLabel for="major" value="Major Version" />
                    <rich:inputNumberSpinner id="major" minValue="#{minVersion.major}" value="#{minVersion.major}"
                        maxValue="32000" cycled="false" inputSize="4" onchange="adjustNextVersion();"
                        enableManualInput="false" />
                    <h:outputLabel for="minor" value="Minor Version" />
                    <rich:inputNumberSpinner id="minor" minValue="#{minVersion.minor}" value="#{minVersion.minor}"
                        maxValue="32000" cycled="false" inputSize="4" onchange="adjustNextVersion()"
                        enableManualInput="false" />
                    <h:outputLabel for="variant" value="Variant Version" />
                    <rich:inputNumberSpinner id="variant" minValue="#{minVersion.variant}" value="#{minVersion.variant}"
                        maxValue="32000" cycled="false" inputSize="4" onchange="adjustNextVersion()"
                        enableManualInput="false" />
                    <h:inputHidden id="newVersion" value="#{tableCopierWizard.version.value}" />
                </h:panelGrid>
            </fieldset>

            <hr />

            <h:commandButton value="Next" action="#{tableCopierWizardManager.next}" />
            <h:commandButton value="Cancel" action="#{tableCopierWizardManager.cancel}" immediate="true" />
        </h:form>

        <script>
            function applyVersion() {
                var version = $("changeVersionForm:newVersion").value;
                if (version &amp;&amp; /^[0-9]+\.[0-9]+\.[0-9]+$/.test(version)) {
                    var sv = version.split('.');
                    $('changeVersionForm:majorEdit').down().value = sv[0];
                    $('changeVersionForm:minorEdit').down().value = sv[1];
                    $('changeVersionForm:variantEdit').down().value = sv[2];
                }
            }

            function adjustNextVersion() {
                var major = $('changeVersionForm:majorEdit').down().value;
                var minor = $('changeVersionForm:minorEdit').down().value;
                var variant = $('changeVersionForm:variantEdit').down().value;
                var version = major + "." + minor + "." + variant;
                $("changeVersionForm:newVersionText").innerHTML = version;
                $("changeVersionForm:newVersion").value = version;
            }
            applyVersion();
            adjustNextVersion();
        </script>

    </ui:define>

</ui:composition>
