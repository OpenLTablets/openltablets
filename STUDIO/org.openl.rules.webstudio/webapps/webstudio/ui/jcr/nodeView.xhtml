<ui:composition
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
  xmlns:rich="http://richfaces.ajax4jsf.org/rich"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:c="http://java.sun.com/jstl/core">

  <c:set var="node" value="#{repositoryTreeController.selected.dataBean}"/>
  <c:set var="nodeType" value="#{repositoryTreeController.selected.type}"/>

  <h:panelGroup rendered="#{nodeType == 'repository'}">
    <h:panelGrid columns="2" styleClass="buttonPanel" cellpadding="4px;" cellspacing="0px;">
      <h:commandButton styleClass="button" value="Create New Project" type="button" onclick="openNewProjectDialog();" />
      <h:commandButton styleClass="button" value="Upload Project"  type="button" onclick="openUploadProjectDialog();" />
    </h:panelGrid>

    <rich:tabPanel style="height:400px;">
      <rich:tab label="Rules Projects">
        <ui:include src="/ui/jcr/projects.xhtml" />
      </rich:tab>
    </rich:tabPanel>
  </h:panelGroup>

  <h:panelGroup rendered="#{nodeType == 'file'}">
    <h:panelGrid columns="2" styleClass="buttonPanel" cellpadding="4px;" cellspacing="0px;">
      <h:commandButton styleClass="#{node.project.checkedOut ? 'button':'disabledButton'}" value="Update" type="button" onclick="#{node.project.checkedOut} &amp;&amp; openUpdateFileDialog();" />
      <h:commandButton styleClass="#{node.project.checkedOut ? 'button':'disabledButton'}" value="Delete" type="button" onclick="#{node.project.checkedOut} &amp;&amp; confirmDeleteNode();" />
    </h:panelGrid>
  </h:panelGroup>

  <h:panelGroup rendered="#{nodeType == 'folder'}">
    <h:panelGrid columns="3" styleClass="buttonPanel" cellpadding="4px;" cellspacing="0px;">
      <h:commandButton styleClass="#{node.project.checkedOut ? 'button':'disabledButton'}" value="Delete" type="button" onclick="#{node.project.checkedOut} &amp;&amp; confirmDeleteNode();" />
      <h:commandButton styleClass="#{node.project.checkedOut ? 'button':'disabledButton'}" value="Add Folder" type="button" onclick="#{node.project.checkedOut} &amp;&amp; openNewFolderDialog();" />
      <h:commandButton styleClass="#{node.project.checkedOut ? 'button':'disabledButton'}" value="Add File" type="button" onclick="#{node.project.checkedOut} &amp;&amp; openNewFileDialog();" />
    </h:panelGrid>
  </h:panelGroup>

  <h:panelGroup rendered="#{nodeType == 'project'}">
    <h:panelGroup rendered="#{node.deleted}">
      <h:panelGrid columns="2" styleClass="buttonPanel" cellpadding="4px;" cellspacing="0px;">
        <h:commandButton styleClass="button" value="Undelete" onclick="return confirmUndeleteProject();" />
        <h:commandButton styleClass="button" value="Erase" action="eraseProject" onclick="return confirmEraseProject();" />
      </h:panelGrid>
    </h:panelGroup>

    <h:panelGroup rendered="#{!node.deleted}">
      <h:panelGrid columns="7" styleClass="buttonPanel" cellpadding="4px;" cellspacing="0px;">
        <h:commandButton styleClass="#{!node.opened ? 'button':'disabledButton'}" value="Open" action="#{repositoryTreeController.openProject}" onclick="return #{!node.opened};"/>
        <h:commandButton styleClass="#{!node.opened ? 'button':'disabledButton'}" value="Open Version" type="button" onclick="#{!node.opened} &amp;&amp; openNewFileDialog();" />
        <h:commandButton styleClass="#{node.opened ? 'button':'disabledButton'}" value="Close" action="#{repositoryTreeController.closeProject}" onclick="return #{node.opened};"/>
        <h:commandButton styleClass="#{!(node.checkedOut || node.locked) ? 'button':'disabledButton'}" value="Check Out" action="#{repositoryTreeController.checkOutProject}" onclick="return #{!(node.checkedOut || node.locked)};"/>
        <h:commandButton styleClass="#{node.checkedOut ? 'button':'disabledButton'}" value="Check In" action="#{repositoryTreeController.checkInProject}" onclick="return #{node.checkedOut};"/>
        <h:commandButton styleClass="button" value="Copy" type="button" onclick="openCopyProjectDialog('#{node.name}');" />
        <h:commandButton styleClass="#{(!node.locked || node.localOnly) ? 'button':'disabledButton'}" value="Delete" type="button" onclick="#{!node.locked || node.localOnly} &amp;&amp; confirmDeleteNode();" />
      </h:panelGrid>
      <h:panelGrid columns="2" styleClass="buttonPanel" cellpadding="4px;" cellspacing="0px;">
        <h:commandButton styleClass="#{node.checkedOut ? 'button':'disabledButton'}" value="Add Folder" type="button" onclick="#{node.checkedOut} &amp;&amp; openNewFolderDialog();" />
        <h:commandButton styleClass="#{node.checkedOut ? 'button':'disabledButton'}" value="Add File" type="button" onclick="#{node.checkedOut} &amp;&amp; openNewFileDialog();" />
      </h:panelGrid>

    </h:panelGroup>
  </h:panelGroup>

  <rich:tabPanel switchType="client" style="height:425px; margin-top:5px;"
    rendered="#{nodeType != 'repository'
   &amp;&amp; nodeType != 'drepository'
   &amp;&amp; nodeType != 'deployment'}">
    <rich:tab label="Properties">
      <h:panelGroup rendered="#{nodeType == 'file'}">
        <ui:include src="/ui/jcr/node/fileProps.xhtml" />
      </h:panelGroup>
      <h:panelGroup rendered="#{nodeType == 'folder'}">
        <ui:include src="/ui/jcr/node/folderProps.xhtml" />
      </h:panelGroup>
      <h:panelGroup rendered="#{nodeType == 'project'}">
        <ui:include src="/ui/jcr/node/projectProps.xhtml" />
      </h:panelGroup>
    </rich:tab>
    <rich:tab label="Versions">
      <ui:include src="/ui/jcr/node/versions.xhtml" />
    </rich:tab>
    <rich:tab label="Elements" rendered="#{nodeType != 'file'}">
      <ui:include src="/ui/jcr/node/elements.xhtml" />
    </rich:tab>
    <rich:tab label="Dependencies" rendered="#{nodeType == 'project'}">
      <ui:include src="/ui/jcr/node/dependency.xhtml" />
    </rich:tab>
  </rich:tabPanel>

  <h:panelGroup rendered="#{nodeType == 'drepository'}">
    <h:panelGrid columns="2" styleClass="buttonPanel" cellpadding="4px;" cellspacing="0px;">
      <h:commandButton styleClass="button" value="Create New Deployment Project" onclick="return openNewDeploymentProjectDialog();" />
    </h:panelGrid>

    <rich:tabPanel style="height:400px;">
      <rich:tab label="Deployment Projects">
        <ui:include src="/ui/jcr/projectsD.xhtml" />
      </rich:tab>
    </rich:tabPanel>
  </h:panelGroup>

  <h:panelGroup rendered="#{nodeType == 'deployment'}">
    <ui:include src="node/deployment.xhtml" />
  </h:panelGroup>

</ui:composition>
