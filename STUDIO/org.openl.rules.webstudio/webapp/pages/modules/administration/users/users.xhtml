<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:a4j="http://richfaces.org/a4j">

    <h:form>

    <h:dataTable id="userList" value="#{usersBean.users}" var="user" styleClass="table">
        <h:column>
            <f:facet name="header">
                Username
            </f:facet>
            <span style="white-space: pre;">#{user.username}</span>
        </h:column>

        <h:column>
            <f:facet name="header">
                First Name
            </f:facet>
            #{user.firstName}
        </h:column>

        <h:column>
            <f:facet name="header">
                Last Name
            </f:facet>
            #{user.lastName}
        </h:column>

        <h:column>
            <f:facet name="header">
                Groups
            </f:facet>
            <ui:repeat var="authority" value="#{user.authorities}">
            <h:panelGroup class="badge #{(authority.hasPrivilege('ADMIN')) ? 'badge-error' : 'badge-info'}" style="margin-right: 2px">#{authority.displayName}</h:panelGroup>
            </ui:repeat>
        </h:column>

            <h:column rendered="#{environment.getProperty('user.mode') == 'ad'}">
                <f:facet name="header">
                    Local user
                </f:facet>
                #{user.internalUser ? 'Yes' : 'No'}
            </h:column>

        <h:column>
            <span class="warning-icon" style="#{usersBean.isUnsafePassword(user) ? '' : 'visibility: hidden'}" title="Unsafe default password"/>
            <a href="javascript:void(0)" style="#{usersBean.canCreateUsers ? '' : 'visibility: hidden'}"
                onclick="editUser('#{utils.toJSText(user.username)}', '#{utils.toJSText(user.firstName)}', '#{utils.toJSText(user.lastName)}', #{user.internalUser}, #{usersBean.getGroups(user)}, #{usersBean.getOnlyAdminGroups()})"
                title="Edit" class="edit-icon"/> <!-- !!! DO NOT REMOVE !!! This comment adds a space before a4j:commandLink tag !!! -->
            <a4j:commandLink execute="@this" render="@form" rendered="#{!usersBean.isSuperuser(user) and !usersBean.isCurrentUser(user)}"
                action="#{usersBean.deleteUser(user.username)}"
                onclick="if(!window.confirm('Are you sure you want to delete the user?')) {return false;}"
                             title="Delete" styleClass="delete-icon"/>
            <span class="su-icon" style="#{usersBean.isSuperuser(user) ? '' : 'display: none'}" title="Superuser cannot be deleted"/>
            <span class="star-icon" style="#{usersBean.isCurrentUser(user) ? '' : 'display: none'}" title="The current user cannot be deleted"/>
        </h:column>
    </h:dataTable>
    </h:form>

    <br />
    <br />

    <a href="javascript:void(0)" onclick="RichFaces.$('modalAddUser').show()" style="#{usersBean.canCreateUsers ? '' : 'display: none'}">Add New User</a>

    <ui:include src="/pages/modules/administration/users/addUser.xhtml" />
    <ui:include src="/pages/modules/administration/users/editUser.xhtml" />

</ui:composition>
