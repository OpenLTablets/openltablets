<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:a4j="http://richfaces.org/a4j"
        xmlns:rich="http://richfaces.org/rich">

    <rich:popupPanel id="modalProjectsWithoutTags" minWidth="530" autosized="true">
        <style>
            #projectsWithoutTagsForm\:projectsWithoutTagsList > tbody > tr > td:first-child {
                text-align: center;
            }
        </style>
        <f:facet name="header">
            <h:outputText value="Projects without tags"/>
        </f:facet>

        <f:facet name="controls">
            <h:graphicImage value="/images/close.gif" class="close"
                            onclick="hideProjectsWithoutTags()" alt="Close"/>
        </f:facet>

        <h:form id="projectsWithoutTagsForm">
            <div>
                <h:dataTable id="projectsWithoutTagsList" value="#{projectsWithoutTagsBean.projectsWithoutTags}" var="project"  styleClass="table">
                    <h:column>
                        <f:facet name="header">
                            Apply tags
                        </f:facet>
                        <h:selectBooleanCheckbox value="#{project.fillTags}" title="Uncheck if you do not want to apply tags to the project"/>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            Repository
                        </f:facet>
                        <h:outputText value="#{project.repoName}"/>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            Path
                        </f:facet>
                        <h:outputText value="#{project.projectPath}"/>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            Name
                        </f:facet>
                        <h:outputText value="#{project.projectName}"/>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            Tags to apply
                        </f:facet>
                        <div>
                            <ui:repeat value="#{project.tags}" var="tag" varStatus="status">
                                <h:panelGroup rendered="#{tag.addExistingTag}">
                                    <span title="#{tag.type}: #{tag.name}." class="tag-value"><h:outputText value="#{tag.name}"/></span>
                                </h:panelGroup>
                                <h:panelGroup rendered="#{tag.willCreate}">
                                    <span title="#{tag.type}: #{tag.name}. Tag will be created." class="tag-value tag-will-create"><h:outputText value="#{tag.name}"/></span>
                                </h:panelGroup>
                                <h:panelGroup rendered="#{tag.cannotCreate}">
                                    <span title="#{tag.type}: #{tag.name}. Tag isn't extensible, so it will not be created." class="tag-value tag-cannot-create"><h:outputText value="#{tag.name}"/></span>
                                </h:panelGroup>
                                <h:panelGroup rendered="#{tag.willStayUnchanged}">
                                    <span title="#{tag.type}: #{tag.name}. Already has this tag. Will stay unchanged." class="tag-value tag-stay-unchanged"><h:outputText value="#{tag.name}"/></span>
                                </h:panelGroup>
                                <h:panelGroup rendered="#{tag.willReplace}">
                                    <span title="#{tag.type}: '#{tag.existingName}' will be replaced with '#{tag.name}'." class="tag-replace">
                                        <span class="tag-value"><h:outputText value="#{tag.existingName}"/></span>
                                        ðŸ¢‚
                                        <span class="tag-value"><h:outputText value="#{tag.name}"/></span>
                                    </span>
                                </h:panelGroup>
                            </ui:repeat>
                        </div>
                    </h:column>
                </h:dataTable>
            </div>

            <footer>
                <a4j:commandButton value="Save" action="#{projectsWithoutTagsBean.applyTags}"
                                   oncomplete="hideProjectsWithoutTags();$j('#tag-types-list').trigger('refresh');"
                                   styleClass="button-primary"/>
                <input type="button" value="Cancel" onclick="hideProjectsWithoutTags()"/>
            </footer>

            <a4j:jsFunction name="initProjectsWithoutTags" action="#{projectsWithoutTagsBean.init}" render="@form"
                            oncomplete="showProjectsWithoutTags();"/>

        </h:form>

    </rich:popupPanel>

    <script>
        //<![CDATA[
        function openProjectsWithoutTags() {
            initProjectsWithoutTags();
        }

        function showProjectsWithoutTags() {
            RichFaces.$('modalProjectsWithoutTags').show();
        }

        function hideProjectsWithoutTags() {
            RichFaces.$("modalProjectsWithoutTags").hide();
        }

        //]]>
    </script>

</ui:composition>
