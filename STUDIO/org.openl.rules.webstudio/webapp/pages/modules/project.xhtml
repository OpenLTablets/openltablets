<ui:composition
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:a4j="http://richfaces.org/a4j">

    <style>
        .configBlock {
            margin: 7px 3px;
            padding: 8px;
            border: 1px solid #eeeeee;
            background: #f5f5f5;
            text-align: left;
        }

        .blockHeader {
            color: #1199EE;
            font-size: 12px;
        }

        .removeButton {
            vertical-align: top
        }

        .itemsList {
            border-collapse: collapse;
        }

        .itemsList .removeButton{
            padding-left: 8px;
        }

        .itemsList td {
            padding: 0px;
        }
    </style>

    <f:event type="preRenderView" listener="#{projectBean.init()}" />

    <div class="content" style="margin: 11px 14px">

        <ui:param name="editable" value="#{studio.model.editable}" />
        <ui:param name="project" value="#{studio.currentProjectDescriptor}" />

        <h:panelGrid columns="2" cellspacing="6">
            <h:outputText value="#{msg['ws.project.name']}: " style="font-weight: bold" />
            <h:panelGroup>
                <h:inputText maxlength="100" size="40" value="#{project.name}" rendered="#{editable}"/>
                <h:outputText value="#{project.name}" rendered="#{!editable}"/>
            </h:panelGroup>

            <h:outputText value="Description"/>
            <h:panelGroup>
                <h:inputText maxlength="100" size="40" value="#{project.comment}" rendered="#{editable}"/>
                <h:outputText value="#{project.comment}" rendered="#{!editable}"/>
            </h:panelGroup>
        </h:panelGrid>

        <h:panelGrid columns="2" columnClasses="label," styleClass="configBlock">
            <h:outputText value="Project id" styleClass="#{editable ? 'required' : ''}"/>
            <h:panelGroup>
                <h:inputText maxlength="100" size="40" value="#{project.id}" rendered="#{editable}"/>
                <h:outputText value="#{project.id}" rendered="#{!editable}"/>
            </h:panelGroup>

            <h:outputText value="Classpath"/>
            <h:panelGroup>
                <ui:repeat var="path" value="#{project.classpath}">
                    <h:panelGrid columns="2" columnClasses=",removeButton" styleClass="itemsList">
                        <h:inputText maxlength="100" size="40" value="#{path.path}" rendered="#{editable}"/>
                        <h:outputText value="#{path.path}" rendered="#{!editable}"/>

                        <a4j:commandLink title="Remove" action="#{repositoryProjectRulesConfig.deleteClasspath(path)}"
                                         rendered="#{editable}">
                            <img style="margin-left: 3px; opacity: 0.5" src="webresource/images/close.gif" />
                        </a4j:commandLink>
                    </h:panelGrid>
                </ui:repeat>
            </h:panelGroup>
            <a4j:commandLink action="#{repositoryProjectRulesConfig.addClasspath}" rendered="#{editable}"
                value="Add new classpath" title="Add new classpath"/>

        </h:panelGrid>

        <br/>

        <h:panelGroup>
            <h:outputText value="Modules:" styleClass="blockHeader #{editable ? 'required' : ''}"/>
            <br/>
            <ui:repeat var="module" value="#{project.modules}" varStatus="i">
                <h:panelGrid columns="2" columnClasses=",removeButton" styleClass="configBlock">
                    <h:panelGrid id="#{i.index}currentModule" columns="2" columnClasses="label,">
                        <h:outputText value="Name" styleClass="#{editable ? 'required' : ''}"/>
                        <h:inputText  maxlength="100" size="40" value="#{module.name}" rendered="#{editable}"/>
                        <h:outputText value="#{module.name}" rendered="#{!editable}"/>

                        <h:outputText value="Type" styleClass="#{editable ? 'required' : ''}"/>
                        <h:selectOneMenu  value="#{module.type}" disabled="#{!editable}">
                            <ui:remove>
                                <f:ajax event="change" execute="#{i.index}currentModule" render="#{i.index}currentModule" />
                            </ui:remove>
                            <f:selectItem itemValue="STATIC" itemLabel="Static" />
                            <f:selectItem itemValue="DYNAMIC" itemLabel="Dynamic" />
                            <f:selectItem itemValue="API" itemLabel="API" />
                        </h:selectOneMenu>

                        <ui:param name="needJavaClassName" value="#{module.type != 'API'}" />
                        <h:outputText value="Class" rendered="#{needJavaClassName}" styleClass="#{editable ? 'required' : ''}"/>
                        <h:inputText maxlength="100" size="40" value="#{module.classname}" rendered="#{editable and needJavaClassName}"/>
                        <h:outputText value="#{module.classname}" rendered="#{!editable and needJavaClassName}"/>

                        <h:outputText value="Rules root path" styleClass="#{editable ? 'required' : ''}"/>
                        <h:inputText maxlength="100" size="40" value="#{module.rulesRootPath.path}" rendered="#{editable}"/>
                        <h:outputText value="#{module.rulesRootPath.path}" rendered="#{!editable}"/>

                        <h:outputText value="Included methods (comma separated)"/>
                        <h:inputText maxlength="100" size="40" value="#{module.methodFilter.includedMethods}" rendered="#{editable}"/>
                        <h:outputText value="#{module.methodFilter.includedMethods}" rendered="#{!editable}"/>

                        <h:outputText value="Excluded methods (comma separated)"/>
                        <h:inputText maxlength="100" size="40" value="#{module.methodFilter.excludedMethods}" rendered="#{editable}"/>
                        <h:outputText value="#{module.methodFilter.excludedMethods}" rendered="#{!editable}"/>
                    </h:panelGrid>

                    <a4j:commandLink title="Remove" action="#{repositoryProjectRulesConfig.deleteModule(module)}"
                                     rendered="#{editable}">
                        <img style="margin-left: 3px; opacity: 0.5" src="webresource/images/close.gif" />
                    </a4j:commandLink>
                </h:panelGrid>
            </ui:repeat>
            <a4j:commandLink action="#{repositoryProjectRulesConfig.addModule}" rendered="#{editable}"
                             value="Add new module" title="Add new module"/>
        </h:panelGroup>

        <br />
        <br />

        <a4j:commandButton value="Save Configuration" action="#{repositoryProjectRulesConfig.saveConfiguration}" rendered="#{editable}" render="projectTree nodeView" />
        <a4j:commandButton value="Delete Configuration" action="#{repositoryProjectRulesConfig.deleteConfiguration}" rendered="#{editable}" render="projectTree nodeView"
                           onclick="if(!window.confirm('Are you sure you want to delete the rules configuration?')) {return false;}"/>

    </div>

</ui:composition>
