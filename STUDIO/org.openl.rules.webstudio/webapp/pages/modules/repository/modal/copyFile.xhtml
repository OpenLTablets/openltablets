<ui:composition
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:rich="http://richfaces.org/rich"
        xmlns:ui="http://java.sun.com/jsf/facelets">

    <rich:popupPanel id="modalCopyFile" width="400" autosized="true">
        <f:facet name="header">
            <h:outputText value="Copy file"/>
        </f:facet>

        <f:facet name="controls">
            <h:graphicImage value="/images/close.gif" class="close" onclick="RichFaces.$('modalCopyFile').hide();"
                            alt="Close"/>
        </f:facet>

        <h:form id="copyFileForm">
            <h:panelGroup id="modalCopyFileData">
                <h:panelGrid columns="2" styleClass="formfields" cellspacing="1" columnClasses="label">
                    <h:outputText value="File Name"/>
                    <h:outputLabel id="copyingFileName" value="#{node.name}"/>

                    <ui:param name="hasVersions" value="#{!empty repositoryTreeState.selectedProject and !repositoryTreeState.localOnly and node.hasVersions()}"/>

                    <h:outputLabel for="currentRevision" value="Current Revision" rendered="#{hasVersions}"/>
                    <h:selectBooleanCheckbox id="currentRevision" value="true" onchange="showFileRevision(!this.checked)"
                                             rendered="#{hasVersions}"/>
                </h:panelGrid>

                <h:panelGrid columns="2" styleClass="formfields file-revision hidden" cellspacing="1" columnClasses="label">
                    <h:outputLabel for="fileVersion" value="File Revision" rendered="#{hasVersions}"/>
                    <h:selectOneMenu id="fileVersion" value="#{repositoryTreeController.version}" required="true"
                                     rendered="#{hasVersions}">
                        <f:selectItems value="#{node.selectedFileVersions}"/>
                    </h:selectOneMenu>
                </h:panelGrid>

                <h:panelGrid columns="2" styleClass="formfields" cellspacing="1" columnClasses="label">
                    <ui:param name="path" value="#{repositoryTreeController.currentNodePath}"/>
                    <h:outputLabel for="copyFileForm:filePath" styleClass="required" value="New File Path"/>
                    <input type="text" id="copyFileForm:filePath" name="copyFileForm:filePath" value="#{path}"/>
                </h:panelGrid>
            </h:panelGroup>

            <footer>
                <h:commandButton value="Copy" action="#{repositoryTreeController.copyFileVersion}"
                                 onclick="RichFaces.$('modalCopyFile').hide();" styleClass="button-primary"/>
                <input type="button" value="Cancel" onclick="RichFaces.$('modalCopyFile').hide();"/>
            </footer>
        </h:form>

    </rich:popupPanel>

    <script>
        function openCopyFileDialog() {
            $j("#copyFileForm\\:currentRevision").attr('checked', true);
            showFileRevision(false);
            RichFaces.$('modalCopyFile').show();
            focusElement('copyFileForm:fileVersion');
        }

        function showFileRevision(show) {
            $j(".file-revision").each(function() {
                if (show) {
                    $j(this).removeClass("hidden");
                } else {
                    $j(this).addClass("hidden");
                }
            });
        }
    </script>
</ui:composition>
