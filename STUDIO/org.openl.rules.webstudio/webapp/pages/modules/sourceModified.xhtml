<?xml version="1.0" encoding="UTF-8"?>
<html
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:a4j="http://richfaces.org/a4j">

    <ui:param name="sourceModified" value="#{studio.model.sourceModified}" />

    <h:head></h:head>

    <h:body>
        <script>
            function sourceModified() {
                if (confirm('Project source file was modified.\nClick \'OK\' to reload WebStudio with changes, and \'Cancel\' to ignore changes.')) {
                    top.showLoader();
                    reload();
                } else {
                    resetChecking();
                }
            }
        </script>

        <a4j:jsFunction name="reload" action="#{mainBean.reload}" render="poll"
            oncomplete="top.ws.nav.reload(true); top.hideLoader();" />

        <a4j:jsFunction name="resetChecking" action="#{studio.model.resetSourceModified}" render="poll" />

        <h:form>
            <a4j:poll id="poll" enabled="#{!sourceModified}" interval="4000" render="poll"
                oncomplete="#{sourceModified ? 'sourceModified()' : ''}" />
        </h:form>

    </h:body>

</html>
