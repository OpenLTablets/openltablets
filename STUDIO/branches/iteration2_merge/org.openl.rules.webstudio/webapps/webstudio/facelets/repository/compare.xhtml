<ui:composition
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
  xmlns:rich="http://richfaces.ajax4jsf.org/rich"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:t="http://myfaces.apache.org/tomahawk"
  template="/common/baseToolbar.xhtml">

  <ui:define name="title">Structured Diff</ui:define>

  <ui:define name="page">
    <a4j:loadStyle src="resource:///css/flexTree.css" />
    <a4j:loadScript src="resource:///javascript/flexTree/prototype-1.6.0.2.js" />
    <a4j:loadScript src="resource:///javascript/flexTree/dataLoader.js" />
    <a4j:loadScript src="resource:///javascript/flexTree/flexTree.js" />

    <h:form id="compareForm">
      <div id="colorScheme">
        <h:panelGrid columns="1" cellpadding="0px" cellspacing="0px">
          <h:outputText value="Version"/>
          <h:selectOneMenu value="#{diffState.version}" onchange="submit()" required="false">
            <f:selectItems value="#{diffController.versions}"/>
          </h:selectOneMenu>
        </h:panelGrid>
      </div>
    </h:form>

    <table>
      <tr>
        <td valign="top">

        <table>
          <tr>
            <td>
            User workspace version
            </td>
            <td>
            Version #{diffState.version}
            </td>
          </tr>

          <tr>
            <td>
            <div id="treeboxbox_tree1"
              style="width: 450px; height: 650px; background-color: #f5f5f5; border: 1px solid Silver;"></div>
            </td>

            <td>
            <div id="treeboxbox_tree2"
              style="width: 450px; height: 650px; background-color: #f5f5f5; border: 1px solid Silver;"></div>
            </td>
          </tr>
        </table>
        <br />

        </td>
      </tr>

    </table>


    <script>
      function onClickHandler1(key) {
        tree2.selectItem(key);
      }

      function onClickHandler2(key) {
        tree1.selectItem(key);
      }

      function onOpenHandler1(key, state) {
        if (state==-1 || state==0) {
          tree2.openItem(key);
        } else {
          tree2.closeItem(key);
        }
        return true;
      }

      function onOpenHandler2(key, state) {
        if (state==-1 || state==0) {
          tree1.openItem(key);
        } else {
          tree1.closeItem(key);
        }
        return true;
      }

      var tree1=new flexTree("treeboxbox_tree1","100%","100%",1);
      var tree2=new flexTree("treeboxbox_tree2","100%","100%",2);

      tree1.setImagePath("#{contextPath}/images/flexTree/");
      //tree.enableDragAndDrop(0);
      //tree.enableTreeLines(false);
      //tree.setImageArrays("plus","","","","plus.gif");
      //tree.setImageArrays("minus","","","","minus.gif");
      //tree.setStdImages("book.gif","books_open.gif","books_close.gif");
      tree1.setOnClickHandler(onClickHandler1);
      tree1.setOnOpenHandler(onOpenHandler1);
      tree1.setOnDblClickHandler(onOpenHandler1);
      tree1.setShowNodeTooltips(true);
      tree1.treeContainerElement.onscroll = function() { tree2.treeContainerElement.scrollTop=tree1.treeContainerElement.scrollTop; }
      tree1.setXMLAutoLoading("#{contextPath}/faces/repository/diff/loadTree.xhtml?treeId=1");
      tree1.loadXML("#{contextPath}/faces/repository/diff/loadTree.xhtml?treeId=1");

      tree2.setOnClickHandler(onClickHandler2);
      tree2.setOnOpenHandler(onOpenHandler2);
      tree2.setOnDblClickHandler(onOpenHandler2);
      //tree2.treeContainerElement.onscroll = function() { tree1.treeContainerElement.scrollTop=tree2.treeContainerElement.scrollTop; }
      tree2.setImagePath("#{contextPath}/images/flexTree/");
      tree2.setXMLAutoLoading("#{contextPath}/faces/repository/diff/loadTree.xhtml?treeId=2");
      tree2.loadXML("#{contextPath}/faces/repository/diff/loadTree.xhtml?treeId=2");
    </script>

  </ui:define>
</ui:composition>
