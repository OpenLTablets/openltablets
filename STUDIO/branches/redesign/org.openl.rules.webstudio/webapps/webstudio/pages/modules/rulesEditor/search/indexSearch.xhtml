<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions"
    xmlns:jsffn="http://rules.openl.org/taglibs/jsffn"
    template="/pages/layout/rulesEditorLayout.xhtml">

    <ui:define name="content">
        <link href="#{contextPath}/css/indexSearch.css" rel="stylesheet" type="text/css"></link>

        <br />
        <c:if test="#{not indexSearchBean.ready}">
            <p class="warning">There is no valid projects in workspace. Or your session have expired and you need to reload project</p>
        </c:if>

        <!-- Index Letters -->
        <div class="lettersPanel">
            <table><tr>
                <a4j:repeat var="letter" value="#{indexSearchBean.indexLetters}">
                    <td>
                        <h:outputLink value="##{letter}">
                            <span><h:outputText value="#{letter}" /></span>
                        </h:outputLink>
                    </td>
                </a4j:repeat>
            </tr></table>
        </div>

        <!-- Search Results -->
        <div class="searchResultsPanel">
            <h:outputText value="No results found" rendered="#{empty indexSearchBean.indexLetters}"
                style="font-weight: bold" />
            <a4j:repeat var="letter" value="#{indexSearchBean.indexLetters}"
                binding="#{indexSearchBean.searchLetters}" rendered="#{not empty indexSearchBean.indexLetters}">
               
                <c:set var="indexTokens" value="#{indexSearchBean.indexTokens}" />
                <c:set var="tokensLength" value="#{fn:length(indexTokens)}" />
               
                <div>
                    <a name="#{letter}" style="font-weight: bold; font-size: 160%;">
                        <h:outputText value="#{letter} (#{tokensLength})" />
                    </a>

                    <br /><br />

                    <table>

						<c:set var="colWidth" value="#{100 div indexSearchBean.columnsCount}" />
						
	   					<ui:repeat value="#{indexSearchBean.orderedIndexTokens}" var="row">
	   					   	<tr>
			   					<ui:repeat value="#{row}" var="indexToken">
		                            <td width="#{colWidth}%">
		                                <h:outputLink rendered="#{indexToken != null}"
		                                    value="#{contextPath}/faces/pages/modules/rulesEditor/search/showIndexSearchResults.xhtml">
		                                    <f:param name="searchQuery" value="#{indexToken.displayValue}" />
		                                    <h:outputText
		                                        value="#{indexToken.displayValue} (#{fn:length(indexToken.indexElements)})" />
		                                </h:outputLink>
		                            </td>
			   					</ui:repeat>
			   				</tr>
	   					</ui:repeat>
                        
                    </table>
                    <br />
                </div>
            </a4j:repeat>

        </div>
        
    </ui:define>
</ui:composition>
