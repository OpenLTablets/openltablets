<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:a4j="http://richfaces.org/a4j"
    template="/pages/layout/wizardStep.xhtml">

    <ui:define name="header">Select scope</ui:define>

    <ui:define name="data">
        <script src="#{contextPath}/javascript/validator.js"></script>
        <style>
            #categoryNameModule table tr {
                 vertical-align: top;
            }
        </style>

    	<h:form prependId="false">
          <h:outputText value="Table Scope: " />
          <h:selectOneMenu id="scopeType" value="#{wizard.scopeType}"
             onchange="updateCategoryNameModule()">
  	       <f:selectItems value="#{wizard.scopeTypes}" />
  	    </h:selectOneMenu>
          <br/><br/>
  	   	<fieldset id="categoryNameModule" style="display: none;">
              <legend>Category Name</legend>
              <h:panelGrid columns="2">
                  <h:selectOneRadio id="categoryNameSelector" value="#{wizard.categoryNameSelector}"
                      layout="pageDirection" onchange="updateCategoryNameControls()">
      			    <f:selectItem itemValue="existing" itemLabel="Existing" />
      			    <f:selectItem itemValue="new" itemLabel="New" />
      			    <f:selectItem itemValue="sheetName" itemLabel="As sheet name" />
      			</h:selectOneRadio>
                  <h:panelGrid>
                      <h:selectOneMenu id="categoryNamesList" value="#{wizard.categoryName}">
                          <f:selectItems value="#{wizard.categoryNamesList}" />
                      </h:selectOneMenu>
                      <h:inputText id="newCategoryName" value="#{wizard.newCategoryName}" />
                  </h:panelGrid>
              </h:panelGrid>
  	   	</fieldset>

  	    <hr />
        <br />

        <a4j:commandButton value="Prev" action="#{tableCreatorWizardManager.prev}" immediate="true"
            oncomplete="go('step0.xhtml')" />
        <a4j:commandButton value="Next" action="#{tableCreatorWizardManager.next}" onclick="return validate();"
            oncomplete="go('property/step2.xhtml')">
        </a4j:commandButton>
        <h:commandButton value="Cancel" action="#{tableCreatorWizardManager.cancel}" immediate="true" />
      </h:form>

    <f:verbatim>
    <script>

      function updateCategoryNameModule() {
    	  var scopeType = $j('#scopeType').val();
          var categoryNameModule = $j('#categoryNameModule');
          if (scopeType == 'Category') {
              categoryNameModule.show();
          } else {
              categoryNameModule.hide();
          }
      }

      function updateCategoryNameControls() {
          var selectorCheckedValue = $j("input[name='categoryNameSelector']:checked").val();
          $j('#categoryNamesList').attr("disabled", selectorCheckedValue != 'existing');
          $j('#newCategoryName').attr("disabled", selectorCheckedValue != 'new');
      }

      function validate() {
          return validateNewCategoryName();
      }

      function validateNewCategoryName() {
          var selectorCheckedValue = $j("input[name='categoryNameSelector']:checked").val();
          if (selectorCheckedValue == 'new') {
              return validateRequired('newCategoryName', true);
          }
          return true;
      }

      updateCategoryNameModule();
      updateCategoryNameControls();
    </script>

    </f:verbatim>

  </ui:define>

</ui:composition>
