<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:a4j="http://richfaces.org/a4j">

    <c:set var="rProject" value="#{studio.currentProject}" />

    <style>
        #searchInput {
            position: relative;
        }
        #searchInput input[type='text'] {
            height: 22px;
            width: 185px;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
            padding-right: 20px;
        }
        #searchInput input[type='image'] {
            position: absolute;
            right: 10px;
            top: 3px;
            cursor: pointer;
            opacity: 0.5;
        }
        #otherSearches {
            display: none;
            padding: 3px 5px 4px;
            width: 173px;
        }
        #otherSearches div {
            margin-bottom: 2px;
        }
    </style>

    <h:panelGroup id="topPanel" layout="block">
        <div style="display: inline-block">
            <h:form id="headerForm">
                <div class="buttonPanel">
                    <a4j:ajax render=":topPanel :projects :bottomPanel" oncomplete="refreshCurrent()">
                        <h:commandLink action="#{mainBean.reload}" title="Refresh Projects"><img
                            src="webresource/images/refresh.png" />
                        </h:commandLink>

                        <h:commandLink action="#{mainBean.checkInProject}" title="Check in Project"
                            rendered="#{!empty rProject and rProject.checkedOut}"><img
                            src="webresource/images/repository/checkin.gif" />
                        </h:commandLink>
                        <h:commandLink action="#{mainBean.checkOutProject}" title="Check out Project"
                            rendered="#{!empty rProject and !rProject.localOnly and !rProject.locked}"><img
                            src="webresource/images/repository/checkout.gif" />
                        </h:commandLink>
                    </a4j:ajax>

                    <h:outputLink value="test/runAllTests.xhtml" target="content"
                        title="Run All Tests" rendered="#{treeBean.projectHasTests}"><img
                        src="webresource/images/test_ok.gif" /></h:outputLink>

                    <span style="margin:0 21px"></span>

                    <h:outputLink rendered="#{studio.model.editable}" value="create/index.xhtml"
                        target="content" title="Create new table" styleClass="button">Create New</h:outputLink>

                    <h:outputLink rendered="#{!empty rProject and studio.model.editable}"
                        value="revertModuleChanges.xhtml" target="content" title="Revert Changes"
                        styleClass="button2">Revert</h:outputLink>

                    <span style="margin:0 13px"></span>

                    <h:outputLink rendered="#{!empty rProject and studio.model.projectCompiledSuccessfully}"
                        value="rulesDependencies.xhtml" target="content"
                        title="Rules Dependencies">Dependencies</h:outputLink>
                </div>
            </h:form>
        </div>
        <div style="float: right;">
            <h:panelGroup rendered="#{!empty rProject and studio.model.projectCompiledSuccessfully}">
                <h:outputLink value="javascript:void(0)" style="margin-right: 1px"
                    onclick="showPopupMenu(event, 'otherSearches', $j(this).next(), {'offsetTop' : 4})">
                    <h:graphicImage url="/webresource/images/arrow_down.png" title="Other Searches" />
                </h:outputLink>
                <form style="display: inline;"
                    onsubmit="goTo('search/simpleSearch.xhtml?searchQuery=' + $j('#searchQuery').val()); return false;">
                    <span id="searchInput">
                        <input type="text" id="searchQuery" placeholder="Search..." />
                        <input type="image" src="#{contextPath}/webresource/images/search.png" />
                    </span>
                </form>
                <div id="otherSearches">
                    <div><a href="#search/advancedSearch.xhtml">Advanced</a></div>
                    <div><a href="#search/businessSearch.xhtml">Business</a></div>
                </div>
            </h:panelGroup>

            <div class="buttonPanel" style="display: inline-block; margin-left: 17px">
                <a href="javascript:void(0)" onclick="showPopupMenu(event, 'viewMenu', this, {'offsetTop' : -1})" class="button">View</a>
                <div id="viewMenu" style="display: none; width: 80px; padding: 7px 8px; border-color: orange; color: #555555">
                    <h:form>
                        <div>Show</div>
                        <a4j:ajax oncomplete="refreshCurrent()">
                            <div><h:selectBooleanCheckbox value="#{studio.showHeader}" />Header</div>
                            <div><h:selectBooleanCheckbox value="#{studio.showFormulas}" />Formulas</div>
                        </a4j:ajax>
                    </h:form>
                </div>

                <a target="_blank" style="margin-left: 17px"
                    onclick="window.open('#{rulesEditor}/compare.xhtml','Compare','width=1000,height=800,screenX=50,screenY=100,resizable=yes,scrollbars=yes,status=yes');return false;"
                    href="#" title="Compare Excel files"><img
                src="webresource/images/compare.gif" /></a>
            </div>

        </div>
    </h:panelGroup>

</ui:composition>
