<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich">

    <c:set var="contextPath" value="#{facesContext.externalContext.request.contextPath}" />
    <c:set var="rulesEditor" value="#{contextPath}/faces/pages/modules/rulesEditor" />

    <h:head>
        #{mainBean.init}
        <link href="#{contextPath}/css/common.css" rel="stylesheet" type="text/css"></link>
        <link href="#{contextPath}/css/layout.css" rel="stylesheet" type="text/css"></link>
        <script src="#{contextPath}/javascript/common.js"></script>
        <script src="webresource/js/prototype/prototype-1.6.1.js"></script>
        <h:outputScript name="jquery.js" />
        <script src="#{contextPath}/javascript/jquery-ui-1.8.16.custom.min.js"></script>
        <script src="#{contextPath}/javascript/jquery.layout-1.3.0.js"></script>

        <script>
            var $j = $.noConflict();

            $j.ajaxSetup({
                cache: false
            });

            var urlRewrite = {
                prefix: "#{rulesEditor}/"
            }

            $j(window).bind("hashchange", hashchange);

            $j(document).ready(function () {
                $j('body').layout({
                    closable: false,
                    resizable: false,
                    spacing_open: 1
                });
                $j('#center').layout({
                    useStateCookie: true,
                    north__resizable: false,
                    spacing_open: 3,
                    north__spacing_open: 1
                });
                $j('#center .ui-layout-center').layout({
                    spacing_open: 3
                });

                $j("a[target='content']").live("click", function() {
                    var page = $j(this).attr("href");
                    showLoader();
                    goTo(page, "content");
                    hideLoader();
                    return false;
                });

                //setViewDimensions();
            });

            function goTo(page, target) {
                if (page) {
                    page = page.replace(urlRewrite.prefix, "");
                    location.hash = page;
                }
            }

            function hashchange() {
                if (location.hash) {
                    var page = location.href.split("#")[1];
                    if (page.indexOf(urlRewrite.prefix) &lt; 0) {
                        page = urlRewrite.prefix + page;
                    }
                    $j("#content").load(page);
                }
            }

            /*function setViewDimensions() {
                $j(".view_workspace").each(function() {
                    $j(this).css({
                        "width": $j(this).width() + "px",
                        "height": $j(this).up(".ui-layout-pane").height() - $j(this).prev(".view_toolbar").height() + "px"
                    });
                });
            }
            window.onresize = function(e) {
                setViewDimensions();
            }*/
        </script>

        <title>
            <ui:insert name="title">OpenL Tablets WebStudio</ui:insert>
        </title>
    </h:head>

    <h:body>
        <div id="header" class="ui-layout-north">
            <ui:insert name="header">
                <ui:include src="/pages/common/header.xhtml">
                    <ui:param name="menu" value="rules" />
                </ui:include>
            </ui:insert>
        </div>
        <div id="center" class="ui-layout-center">
            <div id="top" class="ui-layout-north">
                <ui:insert name="top">
                    <ui:include src="/pages/modules/rulesEditor/topPanel.xhtml" />
                </ui:insert>
            </div>
            <div id="left" class="ui-layout-west">
                <ui:insert name="left">
                    <ui:include src="/pages/modules/rulesEditor/leftPanel.xhtml" />
                </ui:insert>
            </div>
            <div class="ui-layout-center">
                <div id="content" class="ui-layout-center">
                    <ui:insert name="content" />
                </div>
                <div class="ui-layout-south">
                    <ui:insert name="bottom">
                        <ui:include src="/pages/modules/rulesEditor/bottomPanel.xhtml" />
                    </ui:insert>
                </div>
            </div>
        </div>
        <div id="footer" class="ui-layout-south">
            <ui:insert name="footer">
                <ui:include src="/pages/common/footer.xhtml" />
            </ui:insert>
        </div>

        <div id="blockPopup" style="display: none"></div>
        <div id="ajaxLoader" style="display: none">
            <img src="webresource/images/ajax-loader.gif" />
        </div>

        <script>
            function showLoader() {
                $j('#blockPopup').fadeIn(500);
                $j('#ajaxLoader').show();
            }
            function hideLoader() {
                $j('#blockPopup').hide();
                $j('#ajaxLoader').slideUp();
            }
        </script>

        <a4j:status onstart="showLoader()" onstop="hideLoader()" />

        <iframe src="#{contextPath}/pages/modules/rulesEditor/sourceModified.xhtml"
            style="visibility: hidden" width="0" height="0" />

        <iframe name="hidden" style="visibility: hidden" width="0" height="0" />

        <!-- Init RichFaces resources -->
        <div style="display: none">
            <rich:popupPanel />
            <rich:calendar />
        </div>

        <script>
            hashchange();
        </script>
    </h:body>
</html>
