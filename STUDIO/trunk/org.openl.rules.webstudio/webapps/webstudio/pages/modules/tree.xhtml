<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    template="/pages/layout/view.xhtml"
    xmlns:a4j="http://richfaces.org/a4j">

   <ui:define name="toolbar">
        <h:form id="rulesTreeViewForm">
            <h:panelGrid rendered="#{studio.currentProject != null}" id="rulesTreeView" columns="2" layout="block"
            columnClasses="rules_tree_view_first_col,rules_tree_view_second_col" style="width: 100%">
                 <h:selectOneMenu id="viewMode" value="#{treeBean.currentView}" style="width: 100%">
                     <f:selectItems value="#{treeBean.views}" />
                     <f:ajax event="change" render=":rulesTree" />
                 </h:selectOneMenu>
                    <h:commandLink title="Recently visited tables" styleClass="imageButton"
                        style="background:url('webresource/images/table_history.png'); border: 0; background-color: transparent !important"
                        onclick="sessionStorage.setItem(SHOW_HISTORY_ITEM,'true'); reloadLeft(); return false;" />
            </h:panelGrid>
        </h:form>
    </ui:define>

    <ui:define name="workspace">
        <rich:tree id="rulesTree" styleClass="tree" value="#{treeBean.tree}" var="node" nodeType="#{node.type}"
            toggleType="client" nodeClass="#{node.active ? '' : 'treeNodeInactive'}">
            <rich:treeNode type="folder"
                iconCollapsed="#{node.state == 1 ? 'webresource/images/tree/folder-error.png' : 'webresource/images/tree/folder.png'}"
                iconExpanded="#{node.state == 1 ? 'webresource/images/tree/folder-error.png' : 'webresource/images/tree/folder.png'}">
                <h:outputText value="#{node.name}" />
            </rich:treeNode>
            <rich:treeNode type="workbook"
                iconCollapsed="#{node.state == 1 ? 'webresource/images/excel-workbook-error.png' : 'webresource/images/excel.png'}"
                iconExpanded="#{node.state == 1 ? 'webresource/images/excel-workbook-error.png' : 'webresource/images/excel.png'}">
                <h:outputText value="#{node.name}" />
            </rich:treeNode>
            <rich:treeNode type="worksheet"
                iconCollapsed="#{node.state == 1 ? 'webresource/images/worksheet-error.png' : 'webresource/images/worksheet.gif'}"
                iconExpanded="#{node.state == 1 ? 'webresource/images/worksheet-error.png' : 'webresource/images/worksheet.gif'}">
                <h:outputText value="#{node.name}" />
            </rich:treeNode>
            <rich:treeNode type="problem" onclick="changeNode(event, '#{node.url}')">
                <h:outputLink value="#{node.url}" title="#{node.title}">
                    <h:outputText value="#{node.name}" />
                </h:outputLink>
            </rich:treeNode>
            <rich:treeNode type="table.xls.dt" onclick="changeNode(event, '#{node.url}')"
                iconCollapsed="#{node.state == 1 ? 'webresource/images/dt3-error.png' : (node.state == 2 ? 'webresource/images/dt3-check.png' : 'webresource/images/dt3.png')}"
                iconExpanded="#{node.state == 1 ? 'webresource/images/dt3-error.png' : (node.state == 2 ? 'webresource/images/dt3-check.png' : 'webresource/images/dt3.png')}"
                iconLeaf="#{node.state == 1 ? 'webresource/images/dt3-error.png' : (node.state == 2 ? 'webresource/images/dt3-check.png' : 'webresource/images/dt3.png')}">
                <h:outputLink value="#{node.url}" title="#{node.title}">
                    <h:outputText value="#{node.name}" />
                </h:outputLink>
            </rich:treeNode>
            <rich:treeNode type="table.xls.spreadsheet" onclick="changeNode(event, '#{node.url}')"
                iconCollapsed="#{node.state == 1 ? 'webresource/images/spreadsheet-error.gif' : 'webresource/images/spreadsheet.gif'}"
                iconExpanded="#{node.state == 1 ? 'webresource/images/spreadsheet-error.gif' : 'webresource/images/spreadsheet.gif'}"
                iconLeaf="#{node.state == 1 ? 'webresource/images/spreadsheet-error.gif' : 'webresource/images/spreadsheet.gif'}">
                <h:outputLink value="#{node.url}" title="#{node.title}">
                    <h:outputText value="#{node.name}" />
                </h:outputLink>
            </rich:treeNode>
            <rich:treeNode type="table.xls.tbasic" onclick="changeNode(event, '#{node.url}')"
                iconCollapsed="#{node.state == 1 ? 'webresource/images/tbasic-error.gif' : (node.state == 2 ? 'webresource/images/tbasic-check.gif' : 'webresource/images/tbasic.gif')}"
                iconExpanded="#{node.state == 1 ? 'webresource/images/tbasic-error.gif' : (node.state == 2 ? 'webresource/images/tbasic-check.gif' : 'webresource/images/tbasic.gif')}"
                iconLeaf="#{node.state == 1 ? 'webresource/images/tbasic-error.gif' : (node.state == 2 ? 'webresource/images/tbasic-check.gif' : 'webresource/images/tbasic.gif')}">
                <h:outputLink value="#{node.url}" title="#{node.title}">
                    <h:outputText value="#{node.name}" />
                </h:outputLink>
            </rich:treeNode>
            <rich:treeNode type="table.xls.columnmatch" onclick="changeNode(event, '#{node.url}')"
                iconCollapsed="#{node.state == 1 ? 'webresource/images/cmatch-error.gif' : (node.state == 2 ? 'webresource/images/cmatch-check.gif' : 'webresource/images/cmatch.gif')}"
                iconExpanded="#{node.state == 1 ? 'webresource/images/cmatch-error.gif' : (node.state == 2 ? 'webresource/images/cmatch-check.gif' : 'webresource/images/cmatch.gif')}"
                iconLeaf="#{node.state == 1 ? 'webresource/images/cmatch-error.gif' : (node.state == 2 ? 'webresource/images/cmatch-check.gif' : 'webresource/images/cmatch.gif')}">
                <h:outputLink value="#{node.url}" title="#{node.title}">
                    <h:outputText value="#{node.name}" />
                </h:outputLink>
            </rich:treeNode>
            <rich:treeNode type="table.xls.data" onclick="changeNode(event, '#{node.url}')"
                iconCollapsed="#{node.state == 1 ? 'webresource/images/data-error.png' : 'webresource/images/data.gif'}"
                iconExpanded="#{node.state == 1 ? 'webresource/images/data-error.png' : 'webresource/images/data.gif'}"
                iconLeaf="#{node.state == 1 ? 'webresource/images/data-error.png' : 'webresource/images/data.gif'}">
                <h:outputLink value="#{node.url}" title="#{node.title}">
                    <h:outputText value="#{node.name}" />
                </h:outputLink>
            </rich:treeNode>
            <rich:treeNode type="table.xls.datatype" onclick="changeNode(event, '#{node.url}')"
                iconCollapsed="#{node.state == 1 ? 'webresource/images/dataobject-error.png' : 'webresource/images/dataobject.gif'}"
                iconExpanded="#{node.state == 1 ? 'webresource/images/dataobject-error.png' : 'webresource/images/dataobject.gif'}"
                iconLeaf="#{node.state == 1 ? 'webresource/images/dataobject-error.png' : 'webresource/images/dataobject.gif'}">
                <h:outputLink value="#{node.url}" title="#{node.title}">
                    <h:outputText value="#{node.name}" />
                </h:outputLink>
            </rich:treeNode>
            <rich:treeNode type="table.xls.environment" onclick="changeNode(event, '#{node.url}')"
                iconLeaf="#{node.state == 1 ? 'webresource/images/config_obj-error.png' : 'webresource/images/config_obj.gif'}">
                <h:outputLink value="#{node.url}" title="#{node.title}">
                    <h:outputText value="#{node.name}" />
                </h:outputLink>
            </rich:treeNode>
            <rich:treeNode type="table.xls.method" onclick="changeNode(event, '#{node.url}')"
                iconCollapsed="#{node.state == 1 ? 'webresource/images/method-error.png' : 'webresource/images/method.gif'}"
                iconExpanded="#{node.state == 1 ? 'webresource/images/method-error.png' : 'webresource/images/method.gif'}"
                iconLeaf="#{node.state == 1 ? 'webresource/images/method-error.png' : 'webresource/images/method.gif'}">
                <h:outputLink value="#{node.url}" title="#{node.title}">
                    <h:outputText value="#{node.name}" />
                </h:outputLink>
            </rich:treeNode>
            <rich:treeNode type="table.xls.test.method" onclick="changeNode(event, '#{node.url}')"
                iconCollapsed="#{node.state == 1 ? 'webresource/images/test_ok-error.gif' : 'webresource/images/test_ok.gif'}"
                iconExpanded="#{node.state == 1 ? 'webresource/images/test_ok-error.gif' : 'webresource/images/test_ok.gif'}"
                iconLeaf="#{node.state == 1 ? 'webresource/images/test_ok-error.gif' : 'webresource/images/test_ok.gif'}">
                <h:outputLink value="#{node.url}" title="#{node.title}">
                    <h:outputText value="#{node.name}" />
                </h:outputLink>
            </rich:treeNode>
            <rich:treeNode type="table.xls.run.method" onclick="changeNode(event, '#{node.url}')"
                iconCollapsed="#{node.state == 1 ? 'webresource/images/test-error.png' : 'webresource/images/run.gif'}"
                iconExpanded="#{node.state == 1 ? 'webresource/images/test-error.png' : 'webresource/images/run.gif'}"
                iconLeaf="#{node.state == 1 ? 'webresource/images/test-error.png' : 'webresource/images/run.gif'}">
                <h:outputLink value="#{node.url}" title="#{node.title}">
                    <h:outputText value="#{node.name}" />
                </h:outputLink>
            </rich:treeNode>
            <rich:treeNode type="table.xls.properties" onclick="changeNode(event, '#{node.url}')"
                iconLeaf="#{node.state == 1 ? 'webresource/images/data-error.png' : 'webresource/images/data.gif'}">
                <h:outputLink value="#{node.url}" title="#{node.title}">
                    <h:outputText value="#{node.name}" />
                </h:outputLink>
            </rich:treeNode>
            <rich:treeNode type="table.xls.other" onclick="changeNode(event, '#{node.url}')">
                <h:outputLink value="#{node.url}" title="#{node.title}">
                    <h:outputText value="#{node.name}" />
                </h:outputLink>
            </rich:treeNode>
        </rich:tree>

        <script>
            openTreeNode();
            
            function changeNode(event, url) {
                event = event || window.event
                var target = event.target || event.srcElement

                // ensure that we didn't click on "a href" element
                if (target.nodeName != 'A') {
                    goTo(url);
                };
            }
        </script>

    </ui:define>

</ui:composition>
