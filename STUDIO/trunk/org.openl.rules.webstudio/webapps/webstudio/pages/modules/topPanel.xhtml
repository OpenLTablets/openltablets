<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:a4j="http://richfaces.org/a4j">

    <c:set var="contextPath" value="#{facesContext.externalContext.request.contextPath}" />
    <c:set var="rProject" value="#{studio.currentProject}" />

    <style>
        #viewMenu {
            color: #555555;
            border-color: #cccccc;
            display: none;
            padding: 7px 8px;
            width: 80px;
        }
    </style>

    <h:panelGroup id="topPanel" layout="block">
        <div style="float: right; position: relative;">
            <h:panelGroup rendered="#{!empty rProject and studio.model.projectCompiledSuccessfully}">
                <ui:include src="/pages/modules/searchForm.xhtml" />
            </h:panelGroup>

            <div class="buttonPanel" style="display: inline-block; margin-left: 17px">
                <a href="javascript:void(0)" onclick="showPopupMenu(event, 'viewMenu', this, {'offsetTop' : -1})"
                    class="button">View</a>
                <div id="viewMenu">
                    <h:form>
                        <div>Show</div>
                        <a4j:ajax oncomplete="reloadCurrent()">
                            <div><h:selectBooleanCheckbox value="#{studio.showHeader}" />Header</div>
                            <div><h:selectBooleanCheckbox value="#{studio.showFormulas}" />Formulas</div>
                        </a4j:ajax>
                    </h:form>
                </div>

                <div style="display:inline-block; margin-left: 15px">
                    <a target="_blank" style="background:url('webresource/images/compare.gif')"
                        onclick="window.open('#{contextPath}/faces/pages/modules/compare.xhtml','Compare','width=1000,height=800,screenX=50,screenY=100,resizable=yes,scrollbars=yes,status=yes');return false;"
                        href="#" title="Compare Excel files" class="imageButton" />
                </div>
            </div>
        </div>

        <div>
            <h:form id="headerForm">
                <div class="buttonPanel">
                    <a4j:ajax oncomplete="reloadCurrent()">
                        <h:commandLink action="#{mainBean.reload}" title="Refresh" styleClass="imageButton"
                            style="background:url('webresource/images/refresh.png')" />

                        <h:commandLink action="#{mainBean.saveProject}" title="Save &amp; Close Project"
                            rendered="#{!empty rProject and rProject.openedForEditing and studio.model.editable}" styleClass="imageButton"
                            style="background:url('webresource/images/repository/checkin.gif')" />
                        <h:commandLink action="#{mainBean.editProject}" title="Edit Project"
                            rendered="#{!empty rProject and !rProject.localOnly and !rProject.locked and studio.model.canStartEditing}"
                            styleClass="imageButton"
                            style="background:url('webresource/images/repository/checkout.gif')" />
                    </a4j:ajax>

                    <h:outputLink value="#test/runAllTests.xhtml"
                        title="Run All Tests" rendered="#{!empty rProject and treeBean.projectHasTests and treeBean.canRun}"
                        styleClass="imageButton" style="background:url('webresource/images/test_ok.gif')" />

                    <span style="margin-left: 17px;" />

                    <h:outputLink rendered="#{studio.model.canCreateTable}" value="#create/index.xhtml"
                        title="Create new table" styleClass="button-primary">Create New</h:outputLink>

                    <h:outputLink rendered="#{!empty rProject and studio.model.editable}"
                        value="#revert.xhtml" title="Revert Changes" styleClass="button">Revert</h:outputLink>

                    <span style="margin-left: 13px;" />

                    <h:outputLink rendered="#{!empty rProject and studio.model.projectCompiledSuccessfully}"
                        value="#rulesDependencies.xhtml" styleClass="button"
                        title="Rules Dependencies">Dependencies</h:outputLink>

                </div>
            </h:form>
        </div>
    </h:panelGroup>

</ui:composition>
