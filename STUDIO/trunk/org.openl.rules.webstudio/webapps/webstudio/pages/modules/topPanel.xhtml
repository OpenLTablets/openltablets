<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:a4j="http://richfaces.org/a4j">

    <ui:include src="/pages/modules/updateModule.xhtml" />
    <ui:include src="/pages/modules/exportModule.xhtml" />

    <c:set var="contextPath" value="#{facesContext.externalContext.request.contextPath}" />
    <c:set var="rProject" value="#{studio.currentProject}" />

    <h:panelGroup id="topPanel" layout="block">
        <div style="float: right; position: relative;margin-right: 35px">
            <h:panelGroup rendered="#{!empty rProject and studio.model.projectCompiledSuccessfully}">
                <ui:include src="/pages/modules/searchForm.xhtml" />
            </h:panelGroup>
       </div>

        <div>
            <h:form id="headerForm">
                <div class="buttonPanel">
					<a4j:ajax oncomplete="reloadCurrent()">
						<h:commandLink action="#{mainBean.reload}" title="Refresh" styleClass="imageButton"
							style="background:url('webresource/images/refresh.png')" />

                        <h:commandLink onclick="openUpdateModuleDialog();return false;"
                            title="Update module to imported module"
                            rendered="#{!empty rProject and rProject.openedForEditing and studio.model.editable}"
                            styleClass="imageButton"
                            style="background:url('webresource/images/repository/update.png')"/>
                        <h:commandLink onclick="openExportModuleDialog();return false;"
                            title="Export module"
                            rendered="#{!empty rProject and rProject.openedForEditing and studio.model.editable}"
                            styleClass="imageButton"
                            style="background:url('webresource/images/repository/export.png')"/>
                        <h:commandLink action="#{mainBean.saveProject}"
							title="Save the project to the Design Repository"
							rendered="#{!empty rProject and rProject.openedForEditing and studio.model.editable}"
							styleClass="imageButton"
							style="background:url('webresource/images/repository/checkin.gif')"/>
						<h:commandLink action="#{mainBean.editProject}"
							title="Edit the project; the project becomes read-only for all other users"
							rendered="#{!empty rProject and !rProject.localOnly and !rProject.locked and studio.model.canStartEditing}"
							styleClass="imageButton"
							style="background:url('webresource/images/repository/checkout.gif')" />
					</a4j:ajax>

					<h:outputLink value="#test/test.xhtml"
						title="Run #{treeBean.projectTestsCount} Test(s)"
						rendered="#{!empty rProject and treeBean.projectTestsCount > 0 and treeBean.canRun}"
						styleClass="imageButton"
						style="background:url('webresource/images/test_ok.gif')" />

                    <h:panelGroup style="margin-left: 17px;" rendered="#{studio.model.canCreateTable or studio.model.canEditTable}">
                        <h:outputLink rendered="#{studio.model.canCreateTable}" value="#create/index.xhtml"
                            title="Create new table" styleClass="button-primary">Create Table</h:outputLink>
                        <h:outputLink rendered="#{studio.model.canEditTable}"
                            value="#revert.xhtml" title="Compare and/or roll back module changes against a specific date" styleClass="button" >Revert</h:outputLink>
                    </h:panelGroup>

                    <span style="margin-left: 13px;" />

                    <h:panelGroup class="dropdown">
                        <h:form>
                        <a class="button dropdown-toggle" data-toggle="dropdown" href="#">
                            More<b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu" role="menu">
                            <h:panelGroup rendered="#{!empty rProject and studio.model.projectCompiledSuccessfully}">
                            <li><a tabindex="-1" href="#rulesDependencies.xhtml">Table Dependency Graph</a></li>
                            <li class="divider"></li>
                            </h:panelGroup>
                            <li class="nav-header">Table View Settings</li>
                            <a4j:ajax oncomplete="reloadCurrent()">
                            <li>
                                <a href="javascript:void(0)"><h:selectBooleanCheckbox value="#{studio.showHeader}" />Show Header</a>
                            </li>
                            <li>
                                <a href="javascript:void(0)"><h:selectBooleanCheckbox value="#{studio.showFormulas}" />Show Formulas</a>
                            </li>
                            </a4j:ajax>
                            <li class="divider"></li>
                            <li><a tabindex="-1" target="_blank"
                                onclick="window.open('#{contextPath}/faces/pages/modules/compare.xhtml','Compare','width=1000,height=800,screenX=50,screenY=100,resizable=yes,scrollbars=yes,status=yes');return false;"
                                href="#">Compare Excel files</a></li>
                        </ul>
                        </h:form>
                    </h:panelGroup>
                </div>
            </h:form>
        </div>
    </h:panelGroup>
    

</ui:composition>
