<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:a4j="http://richfaces.org/a4j">

    <c:set var="contextPath" value="#{facesContext.externalContext.request.contextPath}" />
    <c:set var="rProject" value="#{studio.currentProject}" />

    <style>
        #viewMenu {
            color: #555555;
            border-color: #cccccc;
            display: none;
            padding: 7px 8px;
            width: 80px;
        }
    </style>

    <h:panelGroup id="topPanel" layout="block">
        <div style="float: right; position: relative;">
            <h:panelGroup rendered="#{!empty rProject and studio.model.projectCompiledSuccessfully}">
                <ui:include src="/pages/modules/searchForm.xhtml" />
            </h:panelGroup>

            <div class="buttonPanel" style="display: inline-block; margin-left: 17px">
                <a href="javascript:void(0)" onclick="showPopupMenu(event, 'viewMenu', this, {'offsetTop' : -1})"
                    class="button" title="Show or hide table headers and/or formulas">View</a>
                <div id="viewMenu">
                    <h:form>
                        <div>Show</div>
                        <a4j:ajax oncomplete="reloadCurrent()">
                            <div><h:selectBooleanCheckbox value="#{studio.showHeader}" />Header</div>
                            <div><h:selectBooleanCheckbox value="#{studio.showFormulas}" />Formulas</div>
                        </a4j:ajax>
                    </h:form>
                </div>

                <div style="display:inline-block; margin-left: 15px">
                    <a target="_blank" style="background:url('webresource/images/compare.gif')"
                        onclick="window.open('#{contextPath}/faces/pages/modules/compare.xhtml','Compare','width=1000,height=800,screenX=50,screenY=100,resizable=yes,scrollbars=yes,status=yes');return false;"
                        href="#" title="Show a dialog for comparing Excel files" class="imageButton" />
                </div>
            </div>
        </div>

        <div>
            <h:form id="headerForm">
                <div class="buttonPanel">
					<a4j:ajax oncomplete="reloadCurrent()">
						<h:commandLink action="#{mainBean.reload}" title="Refresh" styleClass="imageButton"
							style="background:url('webresource/images/refresh.png')" />

						<h:commandLink action="#{mainBean.saveProject}"
							title="Save the project to the Design Repository"
							rendered="#{!empty rProject and rProject.openedForEditing and studio.model.editable}"
							styleClass="imageButton"
							style="background:url('webresource/images/repository/checkin.gif')"/>
						<h:commandLink action="#{mainBean.editProject}"
							title="Edit the project; the project becomes read-only for all other users"
							rendered="#{!empty rProject and !rProject.localOnly and !rProject.locked and studio.model.canStartEditing}"
							styleClass="imageButton"
							style="background:url('webresource/images/repository/checkout.gif')" />
					</a4j:ajax>

					<h:outputLink value="#test/runAllTests.xhtml"
						title="Run #{treeBean.projectTestsCount} Test(s)"
						rendered="#{!empty rProject and treeBean.projectTestsCount > 0 and treeBean.canRun}"
						styleClass="imageButton"
						style="background:url('webresource/images/test_ok.gif')" />

					<span style="margin-left: 17px;" />

                    <h:outputLink rendered="#{studio.model.canCreateTable}" value="#create/index.xhtml"
                        title="Create new table" styleClass="button-primary">Create Table</h:outputLink>

                    <h:outputLink rendered="#{!empty rProject and studio.model.canEditTable}"
                        value="#revert.xhtml" title="Compare and/or roll back module changes against a specific date" styleClass="button" onclick="canLeavePage();">Revert</h:outputLink>

                    <span style="margin-left: 13px;" />

                    <h:outputLink rendered="#{!empty rProject and studio.model.projectCompiledSuccessfully}"
                        value="#rulesDependencies.xhtml" styleClass="button"
                        title="Display Dependency graph"
                         onclick="return canLeavePage();" >Dependencies
                    </h:outputLink>

                </div>
            </h:form>
        </div>
    </h:panelGroup>
    

</ui:composition>
