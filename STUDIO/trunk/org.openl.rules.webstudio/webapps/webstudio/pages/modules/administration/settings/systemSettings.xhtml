<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:jsffn="http://rules.openl.org/taglibs/jsffn"
    template="/pages/layout/simpleView.xhtml">

    <ui:define name="workspace">

    <style>
        .fields section div table tr { margin-bottom: 20px; }
        .fields section div .titleColumn { width: 140px; padding: 5px 0; }

        .restartMessage {
            position: fixed;
            top: 85px;
            right: 33px;
        }

        .pathInput { width: 211px; }

        .repositoryConfig > div {
            display: table;
            border-bottom: 1px dashed #aaa;
            margin-bottom: 12px;
            padding: 0 0 12px;
        }

        .repositoryConfig > div:last-child {
            border-bottom: 0;
        }

        .repositoryConfigButton {
            vertical-align: top;
        }

        .addRepositoryConfig {
            margin-top: 10px;
        }
    </style>

    <script>
      $j(function() {
          $j('#tab-container').easytabs({
              animate: false,
              tabActiveClass: "selected-tab",
              panelActiveClass: "displayed"
          });
      });
    </script>

    <h:form>

    <h:panelGroup id="restartMessage" layout="block" styleClass="restartMessage">
        <h:panelGroup rendered="#{studio.needRestart}" layout="block" styleClass="warning_box">
            <b>System settings were changed!</b>
            <br/>You must restart browser
            <br/>to apply the changes.
        </h:panelGroup>
    </h:panelGroup>

    <div id="tab-container" class="tab-panel-vertical">
        <ul>
            <li>
                <a href="#common">
                    <h:graphicImage url="/webresource/images/admin/systemSettings/common.png" alt="Common" />
                    <span>Common</span>
                </a>
            </li>
            <li>
                <a href="#repository">
                    <h:graphicImage url="/webresource/images/admin/systemSettings/repository.png" alt="Repository" />
                    <span>Repository</span>
                </a>
            </li>
            <li>
                <a href="#system">
                    <h:graphicImage url="/webresource/images/admin/systemSettings/java_system.png" alt="Java System" />
                    <span>System</span>
                </a>
            </li>
            <br style="clear:both;" />
        </ul>
        <div class="data-container">
            <div id="common">
                <h:panelGroup id="commonProps" styleClass="fields" layout="block">
                    <section>
                        <h3>User Workspace</h3>
                        <div>
                            <h:panelGrid columns="2" columnClasses="titleColumn">
                                <h:outputText value="Workspace Directory:" />
                                <h:inputText id="workspace-dir" value="#{systemSettingsBean.userWorkspaceHome}" styleClass="pathInput"
                                    disabled="#{jsffn:isSystemProp('user.workspace.home')}" 
                                    validator="#{systemSettingsBean.workSpaceDirValidator}"/>
                            </h:panelGrid>
                        </div>
                    </section>
                    <section>
                        <h3>History</h3>
                        <div>
                            <h:panelGrid columns="2" columnClasses="titleColumn">
                                <h:outputText value="History Directory:" />
                                <h:inputText value="#{systemSettingsBean.projectHistoryHome}" styleClass="pathInput"
                                    disabled="#{jsffn:isSystemProp('project.history.home')}" 
                                   validator="#{systemSettingsBean.historyDirValidator}"/>
                                    
                            </h:panelGrid>
                        </div>
                    </section>
                    <section>
                        <h3>Other</h3>
                        <div>
                            <h:panelGrid columns="2" columnClasses="titleColumn">
                                <h:outputText value="Update table properties ('createdOn', 'modifiedBy' etc.) on editing: " />
                                <h:selectBooleanCheckbox value="#{systemSettingsBean.updateSystemProperties}"
                                    disabled="#{jsffn:isSystemProp('update.system.properties')}"/>
                                <h:outputText value="Date Format:" />
                                <h:inputText id="date-format" value="#{systemSettingsBean.datePattern}"
                                    disabled="#{jsffn:isSystemProp('data.format.date')}" 
                                    validator = "#{systemSettingsBean.dateFormatValidator}"/>
                            </h:panelGrid>
                        </div>
                    </section>
                </h:panelGroup>
            </div>
            <div id="repository">
                <h:panelGroup id="repositoryProps" styleClass="fields" layout="block">
                    <section>
                        <h3>Design Repository</h3>
                        <div>
                        <table><tr><td>
                            <h:panelGrid columns="2" columnClasses="titleColumn">
                                <h:outputText value="Name:" />
                                <h:inputText value="#{systemSettingsBean.designRepositoryName}" disabled="true" />
                                <h:outputText value="Type:" />
                                <h:selectOneMenu value="#{systemSettingsBean.designRepositoryType}">
                                    <f:ajax event="change" render="designRepositoryPathTitle designRepositoryPath" />
                                    <f:selectItem itemValue="local" itemLabel="Local" />
                                    <f:selectItem itemValue="rmi" itemLabel="Remote - RMI" />
                                    <f:selectItem itemValue="webdav" itemLabel="Remote - WebDav" />
                                </h:selectOneMenu>
                                <h:outputText id="designRepositoryPathTitle"
                                    value="#{systemSettingsBean.designRepositoryType == 'local' ? 'Directory' : 'URL'}:" />
                                <h:inputText id="designRepositoryPath"
                                    value="#{systemSettingsBean.designRepositoryPath}" styleClass="pathInput"
                                        disabled="#{systemSettingsBean.designRepositoryPathSystem}" 
                                        validator = "#{systemSettingsBean.designRepositoryValidator}"/>
                            </h:panelGrid>
                        </td></tr></table>
                        </div>
                    </section>
                    <section>
                        <h3>Production Repositories</h3>
                        <div class="repositoryConfig">
                        <ui:param name="productionRepos" value="#{systemSettingsBean.productionRepositoryConfigurations}" />
                        <a4j:repeat value="#{productionRepos}" var="repository">
                            <div>
                                <table>
                                <tr>
                                <td>
                                <h:panelGrid columns="2" columnClasses="titleColumn">
                                    <h:outputText value="Name:" />
                                    <h:inputText value="#{repository.name}" />
                                    <h:outputText value="Type:" />
                                    <h:selectOneMenu value="#{repository.type}">
                                        <f:ajax event="change" render="productionRepositoryPathTitle productionRepositoryPath" />
                                        <f:selectItem itemValue="local" itemLabel="Local" />
                                        <f:selectItem itemValue="rmi" itemLabel="Remote - RMI" />
                                        <f:selectItem itemValue="webdav" itemLabel="Remote - WebDav" />
                                    </h:selectOneMenu>
                                    <h:outputText id="productionRepositoryPathTitle"
                                        value="#{repository.type == 'local' ? 'Directory' : 'URL'}:" />
                                    <h:inputText id="productionRepositoryPath"
                                        value="#{repository.path}" styleClass="pathInput"
                                        disabled="#{repository.productionRepositoryPathSystem}" 
                                        validator = "#{systemSettingsBean.productionRepositoryValidator}"/>
                                </h:panelGrid>
                                </td>
                                <td class="repositoryConfigButton">
                                    <a4j:commandLink action="#{systemSettingsBean.deleteProductionRepository(repository.configName)}"
                                        title="Delete Production Repository" styleClass="toolbarButton menuButton"
                                        render="repositoryProps" rendered="#{productionRepos.size() > 1}"
                                        onclick="if(!window.confirm('Do you really want to delete repository?')) {return false;}"
                                        onmouseover="$j(this).find('.arrow').css({'visibility':'visible'})"
                                        onmouseout="$j(this).find('.arrow').css({'visibility':'hidden'})" >
                                        <img src="webresource/images/delete.png" alt="Delete Repository" />
                                    </a4j:commandLink>
                                </td>
                                </tr>
                                </table>
                            </div>
                        </a4j:repeat>
                    </div>

                    <div class="addRepositoryConfig">
                        <a4j:commandLink action="#{systemSettingsBean.addProductionRepository}"
                            title="Add Production Repository"
                            styleClass="toolbarButton menuButton" render="repositoryProps"
                            onmouseover="$j(this).find('.arrow').css({'visibility':'visible'})"
                            onmouseout="$j(this).find('.arrow').css({'visibility':'hidden'})">
                            <h:outputText value="Add Production Repository" />
                        </a4j:commandLink>
                    </div>

                    </section>
                </h:panelGroup>
            </div>
            <div id="system">
                <h:panelGroup id="javaProps" styleClass="fields" layout="block">
                    <section>
                        <h3>System</h3>
                            <div>
                                <h:panelGrid columns="2" columnClasses="titleColumn">
                                    <h:outputText value="Custom Spreadsheet Type:" />
                                    <h:selectBooleanCheckbox value="#{systemSettingsBean.customSpreadsheetType}" title="Turn on/off the Custom Spreadsheet Type feature"/>
                                    <h:outputText value="Rules Dispatching Mode:" />
                                    <h:selectOneMenu value="#{systemSettingsBean.rulesDispatchingMode}" title="Select the rule tables dispatching mode">
                                        <f:selectItem itemLabel="Decision Table" itemValue="dt"/>
                                        <f:selectItem itemLabel="Java" itemValue="java"/>
                                    </h:selectOneMenu>
                                </h:panelGrid>
                            </div>
                    </section>
                </h:panelGroup>
            </div>
        </div>
    </div>

    <div style="padding-left: 125px; margin-bottom: 15px">
        <a4j:commandButton value="Restore Defaults" action="#{systemSettingsBean.restoreDefaults}"
            execute="@this" render="commonProps repositoryProps javaProps restartMessage"
            onclick="if(!confirm('Are you sure you want to restore default values?'))return false;" title="Restore the default settings"/>
        <h:outputText value=" " />
        <a4j:commandButton value="Apply" action="#{systemSettingsBean.applyChanges}" render="restartMessage"
            styleClass="button-primary" title = "Apply changes"/>
    </div>

    </h:form>

    </ui:define>

</ui:composition>
