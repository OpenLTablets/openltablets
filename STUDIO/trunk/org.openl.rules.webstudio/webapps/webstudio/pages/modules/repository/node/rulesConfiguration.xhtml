<ui:composition
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:a4j="http://richfaces.org/a4j"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:ui="http://java.sun.com/jsf/facelets">

  <style>
    .configBlock {
        margin: 7px 3px;
        padding: 8px;
        border: 1px solid #eeeeee;
        background: #f5f5f5;
        text-align: left;
    }

    .blockHeader {
        color: #1199EE;
        font-size: 12px;
    }

    .removeButton {
        vertical-align: top
    }

    .itemsList {
        border-collapse: collapse;
    }

    .itemsList .removeButton{
        padding-left: 8px;
    }

    .itemsList td {
        padding: 0px;
    }
  </style>

  <ui:param name="openedForEditing" value="#{artefact.project.openedForEditing}" />
  <ui:param name="hasProjectDescriptor" value="#{repositoryProjectRulesConfig.descriptor != null}" />

  <h:panelGroup rendered="#{!hasProjectDescriptor}">
    <a4j:commandButton value="Create rules configuration" action="#{repositoryProjectRulesConfig.createConfiguration}"
      rendered="#{openedForEditing}"/>
    <h:outputText value="Rules configuration is absent" rendered="#{!openedForEditing}"/>
  </h:panelGroup>

  <h:panelGroup rendered="#{hasProjectDescriptor}">
    <h:outputLabel value="Main configuration" styleClass="blockHeader"/>
    <h:panelGrid columns="2" columnClasses="label," styleClass="configBlock">
      <ui:param name="descriptor" value="#{repositoryProjectRulesConfig.descriptor}" />

      <h:outputLabel for="#{prefix}id" value="Project id" styleClass="#{openedForEditing ? 'required' : ''}"/>
      <h:panelGroup>
          <h:inputText id="#{prefix}id" maxlength="100" size="40" value="#{descriptor.id}" rendered="#{openedForEditing}"/>
          <h:outputText value="#{descriptor.id}" rendered="#{!openedForEditing}"/>
      </h:panelGroup>

      <h:outputLabel for="#{prefix}name" value="Project name"/>
      <h:panelGroup>
          <h:inputText id="#{prefix}name" maxlength="100" size="40" value="#{descriptor.name}" rendered="#{openedForEditing}"/>
          <h:outputText value="#{descriptor.name}" rendered="#{!openedForEditing}"/>
      </h:panelGroup>

      <h:outputLabel for="#{prefix}comment" value="Comment"/>
      <h:panelGroup>
          <h:inputText id="#{prefix}comment" maxlength="100" size="40" value="#{descriptor.comment}" rendered="#{openedForEditing}"/>
          <h:outputText value="#{descriptor.comment}" rendered="#{!openedForEditing}"/>
      </h:panelGroup>

      <h:outputLabel for="#{prefix}classpath" value="Classpath"/>
      <h:panelGroup id="#{prefix}classpath">
      <ui:repeat var="path" value="#{descriptor.classpath}">
        <h:panelGrid columns="2" columnClasses=",removeButton" styleClass="itemsList">
          <h:inputText maxlength="100" size="40" value="#{path.path}" rendered="#{openedForEditing}"/>
          <h:outputText value="#{path.path}" rendered="#{!openedForEditing}"/>

          <a4j:commandLink title="Remove" action="#{repositoryProjectRulesConfig.deleteClasspath(path)}"
              rendered="#{openedForEditing}">
              <img style="margin-left: 3px; opacity: 0.5" src="webresource/images/close.gif" />
          </a4j:commandLink>
        </h:panelGrid>
      </ui:repeat>
      </h:panelGroup>
      <a4j:commandLink action="#{repositoryProjectRulesConfig.addClasspath}" rendered="#{openedForEditing}"
          value="Add new classpath" title="Add new classpath"/>

    </h:panelGrid>

    <br/>

    <h:panelGroup>
      <h:outputLabel value="Modules:" styleClass="blockHeader #{openedForEditing ? 'required' : ''}"/>
      <br/>
      <ui:repeat var="module" value="#{repositoryProjectRulesConfig.modules}">
        <h:panelGrid columns="2" columnClasses=",removeButton" styleClass="configBlock">
          <h:panelGrid id="#{prefix}currentModule" columns="2" columnClasses="label,">
              <h:outputLabel for="#{prefix}name" value="Name" styleClass="#{openedForEditing ? 'required' : ''}"/>
              <h:inputText id="#{prefix}name" maxlength="100" size="40" value="#{module.name}" rendered="#{openedForEditing}"/>
              <h:outputText value="#{module.name}" rendered="#{!openedForEditing}"/>

              <h:outputLabel for="#{prefix}type" value="Type" styleClass="#{openedForEditing ? 'required' : ''}"/>
              <h:selectOneMenu id="#{prefix}type" value="#{module.type}" disabled="#{!openedForEditing}">
                  <f:ajax event="change" execute="#{prefix}currentModule" render="#{prefix}currentModule" />
                  <f:selectItem itemValue="STATIC" itemLabel="Static" />
                  <f:selectItem itemValue="DYNAMIC" itemLabel="Dynamic" />
                  <f:selectItem itemValue="API" itemLabel="API" />
              </h:selectOneMenu>

              <ui:param name="needJavaClassName" value="#{module.type != 'API'}" />
              <h:outputLabel for="#{prefix}classname" value="Class" rendered="#{needJavaClassName}" styleClass="#{openedForEditing ? 'required' : ''}"/>
              <h:inputText id="#{prefix}classname" maxlength="100" size="40" value="#{module.classname}" rendered="#{openedForEditing and needJavaClassName}"/>
              <h:outputText value="#{module.classname}" rendered="#{!openedForEditing and needJavaClassName}"/>

              <h:outputLabel for="#{prefix}rulesRootPath" value="Rules root path" styleClass="#{openedForEditing ? 'required' : ''}"/>
              <h:inputText id="#{prefix}rulesRootPath" maxlength="100" size="40" value="#{module.rulesRootPath.path}" rendered="#{openedForEditing}"/>
              <h:outputText value="#{module.rulesRootPath.path}" rendered="#{!openedForEditing}"/>

              <h:outputLabel for="#{prefix}includedMethods" value="Included methods (comma separated)"/>
              <h:inputText id="#{prefix}includedMethods" maxlength="100" size="40" value="#{module.includedMethods}" rendered="#{openedForEditing}"/>
              <h:outputText value="#{module.includedMethods}" rendered="#{!openedForEditing}"/>

              <h:outputLabel for="#{prefix}excludedMethods" value="Excluded methods (comma separated)"/>
              <h:inputText id="#{prefix}excludedMethods" maxlength="100" size="40" value="#{module.excludedMethods}" rendered="#{openedForEditing}"/>
              <h:outputText value="#{module.excludedMethods}" rendered="#{!openedForEditing}"/>
          </h:panelGrid>

          <a4j:commandLink title="Remove" action="#{repositoryProjectRulesConfig.deleteModule(module)}"
              rendered="#{openedForEditing}">
              <img style="margin-left: 3px; opacity: 0.5" src="webresource/images/close.gif" />
          </a4j:commandLink>
        </h:panelGrid>
      </ui:repeat>
      <a4j:commandLink action="#{repositoryProjectRulesConfig.addModule}" rendered="#{openedForEditing}"
          value="Add new module" title="Add new module"/>
    </h:panelGroup>

    <br />
    <br />
    <a4j:commandButton value="Save Configuration" action="#{repositoryProjectRulesConfig.saveConfiguration}" rendered="#{openedForEditing}" render="projectTree nodeView" />
    <a4j:commandButton value="Delete Configuration" action="#{repositoryProjectRulesConfig.deleteConfiguration}" rendered="#{openedForEditing}" render="projectTree nodeView" 
      onclick="if(!window.confirm('Are you sure you want to delete the rules configuration?')) {return false;}"/>
  </h:panelGroup>

</ui:composition>
