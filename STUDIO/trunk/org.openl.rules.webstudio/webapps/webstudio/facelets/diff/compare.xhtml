<ui:composition
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:a4j="http://richfaces.org/a4j"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  template="/facelets/common/baseToolbar.xhtml"
  xmlns:rules="http://openl-tablets.sourceforge.net/jsf">

  <ui:define name="title">Excel Structured Diff</ui:define>

  <ui:define name="page">
    <style>
      .fileEntry {
        height: 40px;
      }
    </style>

    <h:form id="diffForm">
      <h:panelGrid columns="2">
        <h:outputText value="Select 2 Excel Files" />

        <rich:fileUpload id="fileUpload"
        	clearControlLabel=""
        	uploadData="#{excelDiffController.filesToCompare}"
            maxFilesQuantity="#{excelDiffController.uploadsAvailable}" 
            immediateUpload="true" 
            acceptedTypes="xls, xlsx, xlsm"
            allowFlash="true" 
            listHeight="85px" 
            fileEntryClass="fileEntry">

			<a4j:support event="onuploadcomplete" ajaxSingle="true" reRender="compareButton"></a4j:support>

			<a4j:support event="onclear" ajaxSingle="true" reRender="fileUpload,compareButton">
          		<a4j:actionparam name="fname" noEscape="true" value = "(event.memo.entry)?event.memo.entry.fileName:'' "
                           assignTo="#{excelDiffController.fileName}"
                           actionListener="#{excelDiffController.clearUploadData}" />
     		</a4j:support>

		</rich:fileUpload>

        <h:outputText value="Show equal elements" />
        <h:selectBooleanCheckbox value="#{excelDiffController.showEqualElements}" />

        <h:commandButton id="compareButton" value="Compare" action="#{excelDiffController.compare}" disabled="#{excelDiffController.uploadsAvailable != 0}" />
      </h:panelGrid>
    </h:form>

    <table width="100%">
      <tr>
        <td valign="top">

      <a4j:form id="diffTreeForm" ajaxSingle="true" ajaxSubmit="true" reRender="tableEditor1,tableEditor2,newTree">
        <input type="hidden" name="id" value=""  />
        <table width="100%">
          <tr>
            <td colspan="2" style="height:16px;">
                <a4j:status>
                    <f:facet name="start">
                        <h:graphicImage value="/webresource/images/ajax-loader.gif" />
                        Loading...
                    </f:facet>
                </a4j:status>
            </td>
          </tr>
          <tr>
            <td colspan="2" valign="top">
  <rich:panel style="width:100%; height:480px; background-color: #f5f5f5; border: 1px solid Silver; overflow:auto; clear:left;">
    <rich:tree
      id="newTree"
      switchType="ajax" 
      value="#{excelDiffController.richDiffTree}"
      var="item"
      nodeFace="any"
      ajaxSubmitSelection="true"
      nodeSelectListener="#{excelDiffController.processSelection}"
      reRender="tableEditor1,tableEditor2"
    >
      <rich:treeNode type="any" icon="#{item.icon}" iconLeaf="#{item.icon}">
        <h:outputText value="#{item.name}" />
      </rich:treeNode>
    </rich:tree>
  </rich:panel>
            </td>
          </tr>
          <tr>
            <td>
              File 1 fragment
            </td>
            <td>
              File 2 fragment
            </td>
          </tr>
          <tr>
            <td valign="top">
              <p />
              	<a4j:outputPanel ajaxRendered="true">
           			<rules:tableEditor id="tableEditor1" table="#{excelDiffController.table1}" editable="false"
                        collapseProps="true" filter="#{excelDiffController.filter1}" />
           		</a4j:outputPanel>
            </td>
            <td valign="top">
              <p />
                <a4j:outputPanel ajaxRendered="true">
	           		<rules:tableEditor id="tableEditor2" table="#{excelDiffController.table2}" editable="false"
                        collapseProps="true" filter="#{excelDiffController.filter2}" />
              	</a4j:outputPanel>
            </td>
          </tr>
        </table>

      </a4j:form>
      <br />

        </td>
      </tr>
   </table>
  </ui:define>
</ui:composition>
