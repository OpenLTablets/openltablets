<?xml version="1.0" encoding="utf-8"?>
<ui:composition
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    template="/facelets/common/studioBase.xhtml">

    <ui:define name="header">
        <style type="text/css">
            body {
                margin-left: 10px;
                background: #eceef8;
            }
            #menu {
                width: 95%;
                border: 1px solid gray;
            }
            #menu a {
                margin-right: 2px;
            }
        </style>
    </ui:define>

    <ui:define name="page">
        <p /><p />

        <h:panelGroup>
            <form>
                <!-- Menu BEGIN -->
                <table id="menu">
                    <tr>
                        <td>
                            <h:outputLink
                                value="${contextPath}/faces/facelets/explain/tree.xhtml?rootID=${param.rootID}"
                                title="Tree View"><img src="webresource/images/treeeview.gif"/></h:outputLink>
                        </td>
                        <td style="text-align: right">
                            <input type="checkbox" name="showNames"
                                ${param.showNames == null ? '' : 'checked'} onclick="submit()">Names</input>
                            <input type="checkbox" name="showValues"
                                ${param.showValues == null ? '' : 'checked'} onclick="submit()">Values</input>
                        </td>
                    </tr>
                </table>
                <!-- Menu END -->
                <input type="hidden" name="rootID" value="${param.rootID}" />
            </form>
        </h:panelGroup>

        <p />

        <table>
            <tr>
                <th>Value</th>
                <th>Name</th>
                <th>Formula</th>
            </tr>

        <%
           Explanation expl = explanator.getExplanation(rootID);
           expl.setShowNamesInFormula(showNames != null);
           expl.setShowValuesInFormula(showValues != null);
           expl.setHeader(header);
           String expandID = request.getParameter("expandID");
           if (expandID != null)
                expl.expand(expandID);
                String[] cc = expl.htmlTable(expl.getRoot());
        %>

        <tr>
            <td style="border: 1px solid grey">&nbsp;<%=cc[0]%></td>
            <td style="border: 1px solid grey">&nbsp;<%=cc[1]%></td>
            <td style="border: 1px solid grey">&nbsp;<%=cc[2]%></td>
        </tr>

        <tr>
        <%
          for(int i = 0; i < expl.getExpandedValues().size(); ++i){
          DoubleValue dv = (DoubleValue)expl.getExpandedValues().get(i);
          cc = expl.htmlTable(dv);
        %>

        <tr>
            <td style="border: 1px solid grey">&nbsp;<%=cc[0]%></td>
            <td style="border: 1px solid grey">&nbsp;<%=cc[1]%></td>
            <td style="border: 1px solid grey">&nbsp;<%=cc[2]%></td>
        </tr>
        <%}%>
        </table>

    </ui:define>
</ui:composition>
