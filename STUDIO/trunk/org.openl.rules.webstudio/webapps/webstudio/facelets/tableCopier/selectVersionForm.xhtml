<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:rich="http://richfaces.org/rich"
                xmlns:c="http://java.sun.com/jstl/core">

        <c:set var="minVersion" value="#{tableCopierWizard.minNextVersion}" />
            <h:panelGroup rendered="#{not empty tableCopierWizard.version}">
            <fieldset>
                <legend>
                    <h:outputText value="Current Version: " />
                    <h:outputText id="currentVersionText" value="#{tableCopierWizard.version.value}" />
                    <br/>
                    <h:outputText value="New Version: " />
                    <h:outputText id="newVersionText" value="#{minVersion}" />
                </legend>
                <h:panelGrid columns="2" cellspacing="1" columnClasses="label">
                    <h:outputLabel for="major" value="Major Version" />
                    <rich:inputNumberSpinner id="major" value="#{minVersion.major}"
                        maxValue="32000" cycled="false" inputSize="4" onchange="adjustNextVersion();"
                        enableManualInput="false" />
                    <h:outputLabel for="minor" value="Minor Version" />
                    <rich:inputNumberSpinner id="minor" value="#{minVersion.minor}"
                        maxValue="32000" cycled="false" inputSize="4" onchange="adjustNextVersion()"
                        enableManualInput="false" />
                    <h:outputLabel for="variant" value="Variant Version" />
                    <rich:inputNumberSpinner id="variant" value="#{minVersion.variant}"
                        maxValue="32000" cycled="false" inputSize="4" onchange="adjustNextVersion()"
                        enableManualInput="false" />
                    <h:inputHidden id="newVersion" value="#{tableCopierWizard.version.value}" />
                </h:panelGrid>
            </fieldset>

        <script>
            function adjustNextVersion() {
            	if (isNotMoreThanPrevious()) {
            		restoreVersion();
            	} else {
            		applyVersion();
            	}
            }
            
            function isNotMoreThanPrevious(){
                var major = new Number($('changeVersionForm:majorEdit').down().value);
                if ( major &lt; #{minVersion.major}) {
                    return true;
                } else if ( major &gt; #{minVersion.major}) {
                    return false;
                }
                var minor = new Number($('changeVersionForm:minorEdit').down().value);
                if ( minor &lt; #{minVersion.minor}) {
                    return true;
                } else if ( minor &gt; #{minVersion.minor}) {
                    return false;
                }
                var variant = new Number($('changeVersionForm:variantEdit').down().value);
                if ( variant &lt; #{minVersion.variant}) {
                    return true;
                } else if ( variant &gt; #{minVersion.variant}) {
                    return false;
                }
                return false;
            }
      
        	function restoreVersion(){
                var version = $("changeVersionForm:newVersion").value;
                var sv = version.split('.');
                $('changeVersionForm:majorEdit').down().value = sv[0];
                $('changeVersionForm:minorEdit').down().value = sv[1];
                $('changeVersionForm:variantEdit').down().value = sv[2];
        	}

            function applyVersion() {
                var major = $('changeVersionForm:majorEdit').down().value;
                var minor = $('changeVersionForm:minorEdit').down().value;
                var variant = $('changeVersionForm:variantEdit').down().value;
                var version = major + "." + minor + "." + variant;
                $("changeVersionForm:newVersionText").innerHTML = version;
                $("changeVersionForm:newVersion").value = version;
            }
            applyVersion();
        </script>
            </h:panelGroup>


</ui:composition>
