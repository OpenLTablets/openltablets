<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:c="http://java.sun.com/jstl/core"    
    template="/facelets/common/studioWizardBase.xhtml">
    <ui:define name="header">
        <a4j:loadScript src="resource:///js/validation.js" />
        <style>
            .default_Props {
                border: 1px solid rgb(255,255,0);
            }
        </style>
    </ui:define>
    <ui:define name="page">
        <h:messages errorClass="error" infoStyle="color:green" />

        <h:form id="copyTableForm">
            <h2>
	            <h:panelGrid columns="2">
	                <h:outputText value="Technical table name:" />
	                <h:outputText id="technicalName"
	                    value="#{tableCopierWizard.tableTechnicalName}" />
	            </h:panelGrid>
			</h2>
            <br />

	<fieldset><legend>Table Properties</legend>
		<table>
			<a4j:repeat value="#{tableCopierWizard.propsToCopy}" var="prop">
				<tr>
                    <td><h:outputText value="#{prop.displayName}"/></td>
                    <td>
        				<h:inputText value="#{prop.value}" rendered="#{prop.string}" />
                        <rich:calendar value="#{prop.value}" datePattern="#{prop.format}"
                            defaultTime="00:00" timeZone="#{formatPatterns.defaultTimeZone}"
                            rendered="#{prop.date}" />
        				<h:selectBooleanCheckbox value="#{prop.value}" rendered="#{prop.boolean}" />
                        <input type="hidden" name="id" value="#{prop.name}" />
                    </td>
				</tr>
			</a4j:repeat>
			<!--<tr><td></td><td><b>Default properties:</b></td></tr>
			<a4j:repeat value="#{tableCopierWizard.defaultProps}" var="prop">
				<tr>
                    <td><h:outputText value="#{prop.displayName}"/></td>
                    <td class="default_Props">
    				    <h:inputText value="#{prop.value}" rendered="#{prop.string}" />
                        <rich:calendar value="#{prop.value}" datePattern="#{prop.format}"
                            defaultTime="00:00" timeZone="#{formatPatterns.defaultTimeZone}"
                            rendered="#{prop.date}" />
                        <h:selectBooleanCheckbox value="#{prop.value}" rendered="#{prop.boolean}" />
                    </td>
				</tr>
			</a4j:repeat>-->
		</table>

        <script type="text/javascript">
            var validations = [];
            <a4j:repeat value="#{tableCopierWizard.propsToCopy}" var="prop" binding="#{tableCopierWizard.propsTable}">
                <h:panelGroup rendered="#{not empty prop.constraints.all}">
                    validations.push(<h:outputText value="#{tableCopierWizard.validationJS}" />);
                </h:panelGroup>
            </a4j:repeat>

            function validateAll() {
                var valid = true;
                validations.each(function (v) {
                    valid = valid &amp;&amp; v.validate();
                });
                return valid;
            }
        </script>

		</fieldset>
			<h:inputHidden value="1" id="step" binding="#{tableCopierWizardManager.hiddenStep}" />
      		<h:commandButton value="Prev" action="#{tableCopierWizardManager.prev}" />
      		<h:commandButton value="Next" action="#{tableCopierWizardManager.next}" onclick="return validateAll();" />
      		<h:commandButton value="Cancel" action="#{tableCopierWizardManager.cancel}" />
        </h:form>

    </ui:define>
</ui:composition>
