<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:c="http://java.sun.com/jstl/core"    
    template="/facelets/common/studioWizardBase.xhtml">
    
    <ui:define name="header">
        <a4j:loadScript src="resource:///js/validation.js" />
        <a4j:loadScript src="resource:///js/BaseEditor.js" />
        <a4j:loadScript src="resource:///js/BaseTextEditor.js" />
        <a4j:loadScript src="resource:///js/MultiselectEditor.js" />
        <a4j:loadScript src="resource:///js/DropdownEditor.js" />
        <a4j:loadScript src="resource:///js/AjaxHelper.js" />
        <a4j:loadStyle src="resource:///css/multiselect.css" />
    </ui:define>
    <ui:define name="page">
        <h:messages errorClass="error" infoStyle="color:green" />

        <h:form id="copyTableForm">
            <h2>
	            <h:panelGrid columns="2">
	                <h:outputText value="Technical table name:" />
	                <h:outputText id="technicalName"
	                    value="#{tableCopierWizard.tableTechnicalName}" />
	            </h:panelGrid>
			</h2>
            <br />

	<fieldset><legend>Table Properties</legend>
		<table>
			<a4j:repeat value="#{tableCopierWizard.propsToCopy}" var="prop">
				<tr>
                    <td><h:outputText value="#{prop.displayName}"/></td>
                    <td>
	                 	<rich:calendar value="#{prop.value}" 
	                       			   datePattern="#{prop.format}"
	                       			   defaultTime="00:00" 
	                       			   timeZone="#{formatPatterns.defaultTimeZone}" rendered="#{prop.date}" />
                		 
              		   	<h:panelGroup id="editVersionPanel" rendered="#{prop.name == 'version'}">
              		   		<h:inputText value="#{prop.value}" readonly="#{prop.name == 'version'}"/>
               		   		<input type="button" id="huis" value="Edit" onclick="#{rich:component('modalVersionChange')}.show();"/>
               		   	</h:panelGroup>

               		    <h:selectBooleanCheckbox value="#{prop.value}" rendered="#{prop.boolean}"/>

                		<h:outputText binding="#{tableCopierWizard.enumHelper.enumOutput}" escape="false" value="#{tableCopierWizard.enumHelper.enumValue}" rendered="#{prop.enum}">
                            <f:attribute name="property" value="#{prop}"/>
                        </h:outputText>
                        <h:inputHidden value="#{prop.stringValue}" rendered="#{prop.enum}" />

                		<h:outputText binding="#{tableCopierWizard.enumHelper.enumArrayOutput}" escape="false" value="#{tableCopierWizard.enumHelper.enumArrayValue}" rendered="#{prop.enumArray}">
                            <f:attribute name="property" value="#{prop}"/>
                        </h:outputText>
                        <h:inputHidden value="#{prop.stringValue}" rendered="#{prop.enumArray}" />

           		    	<h:inputText value="#{prop.value}" rendered="#{!(prop.date || prop.name == 'version' || prop.boolean || prop.enum || prop.enumArray)}"/>
               		    
                        <input type="hidden" name="id" value="#{prop.name}" />
                    </td>
				</tr>
			</a4j:repeat>
		</table>

        <script type="text/javascript">
            var validations = [];
            <a4j:repeat value="#{tableCopierWizard.propsToCopy}" var="prop" binding="#{tableCopierWizard.propsTable}">
                <h:panelGroup rendered="#{not empty prop.constraints.all}">
                    validations.push(<h:outputText value="#{tableCopierWizard.validationJS}" />);
                </h:panelGroup>
            </a4j:repeat>

            function validateAll() {
                var valid = true;
                validations.each(function (v) {
                    valid = valid &amp;&amp; v.validate();
                });
                return valid;
            }
        </script>

		</fieldset>
			<h:inputHidden value="1" id="step" binding="#{tableCopierWizardManager.hiddenStep}" />
      		<h:commandButton value="Prev" action="#{tableCopierWizardManager.prev}" />
      		<h:commandButton value="Next" action="#{tableCopierWizardManager.next}" onclick="return validateAll();" />
      		<h:commandButton value="Cancel" action="#{tableCopierWizardManager.cancel}" />
        </h:form>
        
  <rich:modalPanel id="modalVersionChange" width="400" minWidth="400" height="220" minHeight="220">
    <f:facet name="header">
      <h:outputText value="Version" />
    </f:facet>

    <f:facet name="controls">
      <h:graphicImage value="/images/modal/close.png" style="cursor:pointer" alt="Close" title="Close" onclick="#{rich:component('modalVersionChange')}.hide();" />
    </f:facet>

    <h:form id="changeVersionForm">
	    <ui:include src="/facelets/tableCopier/selectVersionForm.xhtml"/>

      <br />
      <rich:separator height="1" />
      <br />

      <h:panelGrid columns="2" styleClass="buttonPanel" cellpadding="4px;" cellspacing="0px;">
        <a4j:commandButton styleClass="button" value="Ok" reRender="editVersionPanel" oncomplete="#{rich:component('modalVersionChange')}.hide();" />
        <input type="button" class="button" value="Cancel" onclick="#{rich:component('modalVersionChange')}.hide();" />
      </h:panelGrid>
    </h:form>

  </rich:modalPanel>

    </ui:define>
</ui:composition>
