<ui:composition
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:a4j="http://richfaces.org/a4j"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:ui="http://java.sun.com/jsf/facelets">

  <rich:modalPanel id="modalSmartRedeploy" width="400" minWidth="400" height="284" minHeight="284">
    <f:facet name="header">
      <h:outputText value="Auto Redeploy" />
    </f:facet>

    <f:facet name="controls">
      <h:graphicImage value="/images/modal/close.png" style="cursor:pointer" onclick="closeSmartRedeploy();" alt="Close" />
    </f:facet>

    <h:form id="smartRedeployForm">
      <div style="width:380px;height:180px;overflow:auto;">
      <h:outputText value="There are no deployment projects containing project '#{repositoryTreeState.selectedProject.name}'" rendered="#{empty  smartRedeployController.items}"/>
      <rich:dataTable id="smartRedeployTable" value="#{smartRedeployController.items}" var="item"
        cellspacing="0px" styleClass="standard" rowClasses="odd,even" rendered="#{not empty smartRedeployController.items}">
        <f:facet name="header">
          <rich:columnGroup>
            <rich:column>
              <h:outputText value="Selected" />
            </rich:column>
            <rich:column>
              <h:outputText value="Deployment Project" />
            </rich:column>
            <rich:column>
              <h:outputText value="Message" />
            </rich:column>
          </rich:columnGroup>
        </f:facet>

        <rich:column style="text-align:center">
          <h:selectBooleanCheckbox value="#{item.selected}" disabled="#{item.disabled}" onclick="updateSmartRedeployBtn()"/>
        </rich:column>
        <rich:column>
          <h:outputText value="#{item.name}" styleClass="#{item.styleForName}" />
        </rich:column>
        <rich:column>
          <h:outputText value="#{item.messages}" escape="false" styleClass="#{item.styleForMessages}" />
        </rich:column>
      </rich:dataTable>
      </div>

      <h:panelGrid columns="2" cellpadding="4px;" cellspacing="0px;">
        <input class="button" value="Select All" type="button" onclick="selectAll4SmartRedeploy(true); return false;" />
        <input class="button" value="Reset All" type="button" onclick="selectAll4SmartRedeploy(false); return false;" />
      </h:panelGrid>

      <h:panelGrid id="processing" columns="2" cellpadding="4px;" cellspacing="0px;"
        styleClass="dr-mpnl-pnl"
        style="width:100px;height:28px;position:absolute;top:120px;left:150px;border-width:2px;visibility:hidden;" >
        <h:graphicImage value="/webresource/images/modal/wait.gif" alt="Waiting" />
        <h:outputText value="Processing..." />
      </h:panelGrid>

      <rich:separator height="1" />
      <br/>

      <h:panelGrid columns="2" styleClass="buttonPanel" cellpadding="4px;" cellspacing="0px;">
        <h:commandButton id="smartRedeployBtn" styleClass="disabledButton" value="Redeploy" onclick="return startSmartRedeploy()" action="#{smartRedeployController.redeploy}" />
        <input id="cancelBtn" type="button" class="button" value="Cancel" onclick="closeSmartRedeploy();" />
      </h:panelGrid>
    </h:form>
  </rich:modalPanel>

  <script>
    function openSmartRedeployDialog() {
      submitMainForm(function() {
        Richfaces.showModalPanel('modalSmartRedeploy');
        window._smartRedeployInProgress = false;
      });
    }

    function isEmptySelection4SmartRedeploy() {
      var table = document.getElementById('smartRedeployForm:smartRedeployTable');
      for (var i = 0; i &lt; table.childNodes[2].childNodes.length; i++) {
        if (table.childNodes[2].childNodes[i].firstChild.firstChild.checked) {
          return false;
        }
      }
      return true;
    }

    function updateSmartRedeployBtn() {
      if (window._smartRedeployInProgress) return;

      document.getElementById('smartRedeployForm:smartRedeployBtn').className = isEmptySelection4SmartRedeploy() ? 'disabledButton' : 'button';
    }

    function selectAll4SmartRedeploy(newState) {
      if (window._smartRedeployInProgress) return;

      var table = document.getElementById('smartRedeployForm:smartRedeployTable');
      for (var i = 0; i &lt; table.childNodes[2].childNodes.length; i++) {
        var item = table.childNodes[2].childNodes[i].firstChild.firstChild;

        if (!item.disabled) item.checked = newState;
      }
      updateSmartRedeployBtn();
    }

    function closeSmartRedeploy() {
      if (window._smartRedeployInProgress) return;
      Richfaces.hideModalPanel('modalSmartRedeploy');
    }

    function startSmartRedeploy() {
      if (window._smartRedeployInProgress) return false;
      if (isEmptySelection4SmartRedeploy()) return false;
      window._smartRedeployInProgress = true;

      document.getElementById('smartRedeployForm:smartRedeployBtn').className = 'disabledButton';
      document.getElementById('cancelBtn').className = 'disabledButton';
      document.getElementById('smartRedeployForm:processing').style.visibility = 'visible';

      return true;
    }
  </script>
</ui:composition>
