<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>
  <bean name="Deployer" class="com.exigen.common.repository.deployment.impl.LocalDeployerFactoryBean">
    <property name="repositoryFactory" ref="MRepositoryFactory" />
    <property name="plugins">
      <list>
        <bean name="TraceDeploymentPlugin" class="com.exigen.common.repository.deployment.impl.TraceDeploymentPlugin" />
      </list>
    </property>
  </bean>

  <bean name="MParseCommand" class="com.exigen.common.repository.deployment.impl.ModuleArchiveParseCommand" />

  <bean name="MRepositoryFactory" class="com.exigen.common.repository.db.LocalHibernateRepositoryFactoryBean">
    <property name="parseCommand" ref="MParseCommand" />
    <property name="sessionFactory" ref="MRepositorySessionFactory" />
  </bean>

  <bean id="dataBase" class="com.exigen.example.solution.admin.database.util.HsqlServerBean">
    <property name="serverProperties">
      <props>
        <prop key="server.port">9101</prop>
        <prop key="server.database.0">mem:runtime-repository</prop>
        <prop key="server.dbname.0">runtime-repository</prop>
      </props>
    </property>
  </bean>

  <bean name="MRepositorySessionFactory" class="org.springframework.orm.hibernate3.LocalSessionFactoryBean" depends-on="dataBase">
    <property name="dataSource" ref="DataSource" />
    <property name="mappingResources">
      <list>
        <value>com/exigen/common/repository/db/RepositoryModule.hbm.xml</value>
        <value>com/exigen/common/repository/db/RepositoryFile.hbm.xml</value>
      </list>
    </property>
    <property name="hibernateProperties">
      <props>
        <prop key="hibernate.dialect">${hibernate.dialect}</prop>
        <prop key="hibernate.show_sql">true</prop>
        <prop key="hibernate.hbm2ddl.auto">create</prop>
        <prop key="hibernate.jdbc.use_streams_for_binary">true</prop>
        <prop key="hibernate.cache.provider_class">org.hibernate.cache.HashtableCacheProvider</prop>
      </props>
    </property>
  </bean>
  <bean id="DataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
    <property name="driverClassName" value="${datasource.driver}" />
    <property name="url" value="${datasource.url}" />
    <property name="username" value="${datasource.username}" />
    <property name="password" value="${datasource.password}" />
  </bean>
  <!-- bean name="MRepositoryFactory"
    class="com.exigen.common.repository.jcr.LocalExigenJCRRepositoryFactoryBean">
    <property name="parseCommand" ref="MParseCommand" />
    <property name="repository" ref="JCRRepository" />
    </bean>
    <bean name="JCRRepository"
    class="com.exigen.cm.impl.LocalExigenJcrRepositoryBean">
    <property name="name" value="default" />
    <property name="properties">
    <value>
    db.dialect.classname=com.exigen.cm.database.dialect.hsql.HyperSonicSQLDatabaseDialect
    connection.driver.classname=org.hsqldb.jdbcDriver
    connection.user=sa connection.password=
    connection.url=jdbc:hsqldb:mem:hsql-jcr-db
    import.nodetypes=com/exigen/cm/jackrabbit/nodetype/ewf_nodetypes.cnd,com/exigen/common/repository/jcr/nodetype/emr_nodetypes.xml
    db.dropcreate=true development.mode=true
    </value>
    </property>
    </bean-->

  <alias alias="com.exigen.common.repository.MRepositoryFactory" name="MRepositoryFactory" />
  <alias alias="com.exigen.common.repository.deployment.Deployer" name="Deployer" />
</beans>