<?xml version="1.0"?>

<project name="build" default="build.dst.project">

<target name="build.test">
  <antcall target="build.dst.project">
    <param name="src.dir" value="../templates/openl.rules.examples.hello" />
    <param name="dst.dir" value="../temp/hello" />
    <param name="dst.project.name" value="hello" />
  </antcall>
</target>

<target name="build.dst.project">
  <antcall target="copy.template">
    <param name="src.dir" value="${src.dir}" />
    <param name="dst.dir" value="${dst.dir}" />
  </antcall>
  <antcall target="template2project">
    <param name="project.dir" value="${dst.dir}" />
    <param name="project.name" value="${dst.project.name}" />
  </antcall>
</target>


<target name="copy.template">
  <copy todir="${dst.dir}" includeemptydirs="true" overwrite="true" preservelastmodified="true">
    <fileset dir="${src.dir}">
    <exclude name="**/.foo"/>
    </fileset>
  </copy>
</target>


<target name="template2project">

	<replace dir="${project.dir}" token="@project.name@" value="${project.name}"/> 
	<replace dir="${project.dir}" token="@plugin.id@" value="${plugin.id}"/> 
	
	
	<!--
 <property name="project.name.macro" value="project.name" />
	
  <antcall target="macro.unwrap">
    <param name="macro.dir" value="${project.dir}"/>
    <param name="macro.token" value="${project.name.macro}"/>
    <param name="macro.value" value="${project.name}"/>
  </antcall>
  -->
</target>


<target name="macro.unwrap">

  <property name="dollar" value="$" />
  <property name="lbrace" value="{" />
  <property name="rbrace" value="}" />

  <replace 
    dir="${macro.dir}" 
    token="${dollar}${lbrace}${macro.token}${rbrace}" 
    value="${macro.value}" />
  
</target>

</project>
